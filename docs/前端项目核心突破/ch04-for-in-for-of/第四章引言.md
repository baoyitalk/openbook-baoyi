# for...in 和 for...of —— 第一性原理拆解

> **面试高频指数：⭐⭐⭐⭐☆**

> **核心奥义一句话**：`for...in` 遍历的是**键（key）**，沿原型链找属性；`for...of` 遍历的是**值（value）**，依赖 Iterator 迭代器接口。记住：**in 找钥匙，of 取东西**。

---

## 🎯 第一性原理：从「遍历的本质」出发

### 遍历到底在遍历什么？

JavaScript 中的数据结构各有特点：

```
┌─────────────────────────────────────────────────────────────────┐
│                     数据结构的两个维度                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   对象 Object                        可迭代对象 Iterable         │
│   ┌─────────────┐                   ┌─────────────┐             │
│   │ key: value  │                   │ [Symbol.iterator]         │
│   │ key: value  │                   │ 返回迭代器对象             │
│   │ key: value  │                   └─────────────┘             │
│   └─────────────┘                                               │
│         │                                  │                    │
│         ▼                                  ▼                    │
│   遍历「属性名」                      遍历「值序列」              │
│   用 for...in                        用 for...of                │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**核心问题**：两种遍历方式的设计目的完全不同！

---

## 一、for...in —— 遍历对象的属性

### 1.1 核心概念

> **for...in** 循环遍历对象的**可枚举属性**（包括原型链上的可枚举属性）。

### 📊 工作原理可视化

```
┌─────────────────────────────────────────────────────────────────┐
│                    for...in 遍历机制                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   const obj = { a: 1, b: 2 }                                    │
│                                                                 │
│   obj 实例                                                      │
│   ┌─────────────────┐                                           │
│   │ a: 1  ✓ 可枚举  │ ←── for...in 会遍历                       │
│   │ b: 2  ✓ 可枚举  │ ←── for...in 会遍历                       │
│   └────────┬────────┘                                           │
│            │ [[Prototype]]                                      │
│            ▼                                                    │
│   Object.prototype                                              │
│   ┌─────────────────────────┐                                   │
│   │ toString  ✗ 不可枚举    │ ←── for...in 不会遍历             │
│   │ hasOwnProperty ✗ 不可枚举│ ←── for...in 不会遍历             │
│   └─────────────────────────┘                                   │
│                                                                 │
│   关键：只遍历「可枚举」属性，但会沿原型链向上查找                  │
└─────────────────────────────────────────────────────────────────┘
```

### 1.2 基础用法

```javascript
// ===== 遍历对象 =====
const person = { name: 'Sam', age: 22, gender: '男' };

for (let key in person) {
    console.log(key, person[key]);
}
// 输出：
// name Sam
// age 22
// gender 男

// ===== 遍历数组（不推荐）=====
const stus = ['Sam', '22', '男'];

for (let index in stus) {
    console.log(index, stus[index]);
}
// 输出：
// 0 Sam
// 1 22
// 2 男
// 注意：index 是字符串 "0", "1", "2"，不是数字！
```

### 1.3 原型链陷阱

```javascript
// ===== 危险：会遍历原型链上的属性 =====
Array.prototype.customMethod = function() {};

const arr = [1, 2, 3];

for (let key in arr) {
    console.log(key);
}
// 输出：
// 0
// 1
// 2
// customMethod  ← 原型链上的属性也被遍历了！

// ===== 解决方案：使用 hasOwnProperty 过滤 =====
for (let key in arr) {
    if (arr.hasOwnProperty(key)) {
        console.log(key);  // 只输出 0, 1, 2
    }
}
```

### 📊 可枚举性解释

```
┌─────────────────────────────────────────────────────────────────┐
│                     属性的可枚举性                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   每个属性都有一个描述符对象：                                    │
│   ┌─────────────────────────────────┐                           │
│   │ {                               │                           │
│   │   value: ...,                   │                           │
│   │   writable: true/false,         │                           │
│   │   enumerable: true/false, ←──── │ 这个决定是否可枚举         │
│   │   configurable: true/false      │                           │
│   │ }                               │                           │
│   └─────────────────────────────────┘                           │
│                                                                 │
│   enumerable: true  → for...in 可以遍历到                        │
│   enumerable: false → for...in 遍历不到                          │
│                                                                 │
│   内置方法（如 toString）默认 enumerable: false                   │
│   自定义属性默认 enumerable: true                                │
└─────────────────────────────────────────────────────────────────┘
```

```javascript
// 查看属性描述符
console.log(Object.getOwnPropertyDescriptor([1,2,3], 'length'));
// { value: 3, writable: true, enumerable: false, configurable: false }

console.log(Object.getOwnPropertyDescriptor({a:1}, 'a'));
// { value: 1, writable: true, enumerable: true, configurable: true }
```

---

## 二、for...of —— 遍历可迭代对象的值

### 2.1 核心概念

> **for...of** 循环遍历**可迭代对象（Iterable）**的值，依赖 **Iterator 接口**。

### 📊 Iterator 迭代器机制

```
┌─────────────────────────────────────────────────────────────────┐
│                    Iterator 迭代器协议                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   可迭代对象必须实现 [Symbol.iterator] 方法                       │
│                                                                 │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │  const iterable = {                                     │   │
│   │      [Symbol.iterator]() {                              │   │
│   │          return {                                       │   │
│   │              next() {                                   │   │
│   │                  return { value: xxx, done: false/true }│   │
│   │              }                                          │   │
│   │          }                                              │   │
│   │      }                                                  │   │
│   │  }                                                      │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│   for...of 执行流程：                                            │
│   1. 调用 [Symbol.iterator]() 获取迭代器                         │
│   2. 反复调用 next()                                            │
│   3. 取出 value 赋值给循环变量                                   │
│   4. done 为 true 时停止                                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 哪些是可迭代对象？

```
┌─────────────────────────────────────────────────────────────────┐
│              可迭代对象（内置 Iterator 接口）                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ✅ 可以用 for...of 遍历：                                      │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │ • Array          数组                                   │   │
│   │ • String         字符串                                 │   │
│   │ • Map            Map 对象                               │   │
│   │ • Set            Set 对象                               │   │
│   │ • TypedArray     类型化数组（Uint8Array 等）             │   │
│   │ • arguments      函数参数对象                            │   │
│   │ • NodeList       DOM 节点列表                           │   │
│   │ • Generator      生成器对象                             │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│   ❌ 不能用 for...of 遍历：                                      │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │ • Object         普通对象（没有 Iterator 接口）          │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 2.3 基础用法

```javascript
// ===== 遍历数组 =====
const letters = ['a', 'b', 'c'];
letters.size = 3;  // 添加自定义属性

for (let letter of letters) {
    console.log(letter);
}
// 输出：a, b, c
// 注意：不会输出 size 属性！只遍历数组元素

// ===== 遍历字符串 =====
const str = "Hello";

for (let char of str) {
    console.log(char);
}
// 输出：H, e, l, l, o

// ===== 遍历 Set =====
const set = new Set([1, 2, 3]);

for (let value of set) {
    console.log(value);
}
// 输出：1, 2, 3

// ===== 遍历 Map =====
const map = new Map([['a', 1], ['b', 2], ['c', 3]]);

for (let [key, value] of map) {
    console.log(key, value);
}
// 输出：
// a 1
// b 2
// c 3

// ===== 遍历生成器 =====
function* gen() {
    yield 1;
    yield 2;
    yield 3;
}

for (let value of gen()) {
    console.log(value);
}
// 输出：1, 2, 3
```

### 2.4 为什么普通对象不能用 for...of？

```javascript
const obj = { a: 1, b: 2, c: 3 };

// ❌ 报错！
for (let value of obj) {
    console.log(value);
}
// TypeError: obj is not iterable

// 原因：普通对象没有实现 [Symbol.iterator] 接口
console.log(obj[Symbol.iterator]);  // undefined

// ✅ 解决方案1：使用 Object.keys/values/entries
for (let key of Object.keys(obj)) {
    console.log(key);  // a, b, c
}

for (let value of Object.values(obj)) {
    console.log(value);  // 1, 2, 3
}

for (let [key, value] of Object.entries(obj)) {
    console.log(key, value);  // a 1, b 2, c 3
}

// ✅ 解决方案2：手动实现 Iterator 接口
const iterableObj = {
    data: ['hello', 'world'],
    [Symbol.iterator]() {
        let index = 0;
        return {
            next: () => {
                if (index < this.data.length) {
                    return { value: this.data[index++], done: false };
                }
                return { value: undefined, done: true };
            }
        };
    }
};

for (let value of iterableObj) {
    console.log(value);  // hello, world
}
```

---

## 三、for...in vs for...of 核心对比

### 📊 完整对比表

```
┌──────────────┬─────────────────────────┬─────────────────────────┐
│    特性       │       for...in          │       for...of          │
├──────────────┼─────────────────────────┼─────────────────────────┤
│   遍历内容    │   键（key/索引）         │   值（value）           │
├──────────────┼─────────────────────────┼─────────────────────────┤
│   适用对象    │   所有对象               │   可迭代对象            │
├──────────────┼─────────────────────────┼─────────────────────────┤
│   原型链      │   ✓ 会遍历               │   ✗ 不会               │
├──────────────┼─────────────────────────┼─────────────────────────┤
│   数组遍历    │   返回索引（字符串）     │   返回元素值            │
├──────────────┼─────────────────────────┼─────────────────────────┤
│   普通对象    │   ✓ 可以                 │   ✗ 不行（需转换）      │
├──────────────┼─────────────────────────┼─────────────────────────┤
│   依赖机制    │   可枚举性               │   Iterator 接口         │
├──────────────┼─────────────────────────┼─────────────────────────┤
│   ES 版本     │   ES1（很早）            │   ES6（2015）           │
└──────────────┴─────────────────────────┴─────────────────────────┘
```

### 📊 执行结果对比

```javascript
const arr = ['a', 'b', 'c'];
arr.customProp = 'test';

// for...in 遍历「键」
for (let x in arr) {
    console.log(x);
}
// 输出: "0", "1", "2", "customProp"
//       ↑ 字符串索引    ↑ 自定义属性也会被遍历！

// for...of 遍历「值」
for (let x of arr) {
    console.log(x);
}
// 输出: "a", "b", "c"
//       只有数组元素，没有 customProp
```

### 📊 可视化记忆图

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│                    in 找钥匙 🔑                                  │
│         ┌─────────────────────────────────────┐                 │
│         │  for (let key in obj)               │                 │
│         │       └── 拿到的是「钥匙」（属性名）   │                 │
│         │                                     │                 │
│         │  房子 🏠                             │                 │
│         │  ┌───┬───┬───┐                      │                 │
│         │  │ a │ b │ c │  ← 钥匙（key）        │                 │
│         │  ├───┼───┼───┤                      │                 │
│         │  │ 1 │ 2 │ 3 │  ← 里面的东西        │                 │
│         │  └───┴───┴───┘                      │                 │
│         └─────────────────────────────────────┘                 │
│                                                                 │
│                    of 取东西 📦                                  │
│         ┌─────────────────────────────────────┐                 │
│         │  for (let value of arr)             │                 │
│         │       └── 拿到的是「东西」（值）      │                 │
│         │                                     │                 │
│         │  传送带 🔄                           │                 │
│         │  ┌───┐ ┌───┐ ┌───┐                  │                 │
│         │  │ 1 │→│ 2 │→│ 3 │  ← 值一个个出来   │                 │
│         │  └───┘ └───┘ └───┘                  │                 │
│         └─────────────────────────────────────┘                 │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 四、最佳实践与使用场景

### 4.1 使用场景推荐

```
┌─────────────────────────────────────────────────────────────────┐
│                      使用场景推荐                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   使用 for...in 的场景：                                         │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │ • 需要遍历对象的属性名                                    │   │
│   │ • 需要检查对象是否有某些属性                              │   │
│   │ • 调试时查看对象结构                                      │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│   使用 for...of 的场景：                                         │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │ • 遍历数组元素（推荐）                                    │   │
│   │ • 遍历字符串字符                                          │   │
│   │ • 遍历 Map/Set                                            │   │
│   │ • 遍历 DOM 节点列表                                       │   │
│   │ • 需要 break/continue 的场景                              │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 4.2 经典面试代码

```javascript
// ===== 面试题1：遍历对象的正确方式 =====

const obj = { a: 1, b: 2, c: 3 };

// 方式1：for...in（注意过滤原型链）
for (let key in obj) {
    if (obj.hasOwnProperty(key)) {
        console.log(key, obj[key]);
    }
}

// 方式2：Object.keys + for...of（推荐）
for (let key of Object.keys(obj)) {
    console.log(key, obj[key]);
}

// 方式3：Object.entries + 解构
for (let [key, value] of Object.entries(obj)) {
    console.log(key, value);
}

// ===== 面试题2：数组遍历方式对比 =====

const arr = [10, 20, 30];

// for...in（不推荐用于数组）
for (let i in arr) {
    console.log(typeof i, i);  // string "0", "1", "2"
}

// for...of（推荐）
for (let val of arr) {
    console.log(val);  // 10, 20, 30
}

// forEach（无法 break）
arr.forEach(val => console.log(val));

// 传统 for（需要索引时使用）
for (let i = 0; i < arr.length; i++) {
    console.log(i, arr[i]);
}

// ===== 面试题3：手写迭代器 =====

// 让普通对象可以被 for...of 遍历
const range = {
    from: 1,
    to: 5,
    [Symbol.iterator]() {
        let current = this.from;
        const last = this.to;
        return {
            next() {
                if (current <= last) {
                    return { value: current++, done: false };
                }
                return { done: true };
            }
        };
    }
};

for (let num of range) {
    console.log(num);  // 1, 2, 3, 4, 5
}

// ===== 面试题4：for...of 与 break/continue =====

const nums = [1, 2, 3, 4, 5];

// for...of 支持 break
for (let num of nums) {
    if (num === 3) break;
    console.log(num);  // 1, 2
}

// for...of 支持 continue
for (let num of nums) {
    if (num === 3) continue;
    console.log(num);  // 1, 2, 4, 5
}

// forEach 不支持 break/continue！
nums.forEach(num => {
    if (num === 3) return;  // 只能用 return 跳过当前，不能中断循环
    console.log(num);  // 1, 2, 4, 5
});
```

---

## 五、完整知识图谱

```
                           遍历方式
                              │
            ┌─────────────────┴─────────────────┐
            │                                   │
        for...in                            for...of
       遍历「键」                           遍历「值」
            │                                   │
    ┌───────┴───────┐                   ┌───────┴───────┐
    │               │                   │               │
  适用于          特点                 适用于          特点
 所有对象      会遍历原型链          可迭代对象      依赖Iterator
    │               │                   │               │
    ▼               ▼                   ▼               ▼
 Object         需要配合            Array           直接遍历
 Array*       hasOwnProperty        String            值
                过滤               Map/Set
                                  Generator
                                   NodeList
```

---

## 六、面试速查清单

### ✅ 必记要点

| 知识点 | for...in | for...of |
|--------|----------|----------|
| **遍历内容** | 键/索引（字符串） | 值 |
| **适用范围** | 所有对象 | 可迭代对象 |
| **原型链** | 会遍历 | 不会 |
| **普通对象** | ✓ 可以 | ✗ 需转换 |
| **数组推荐** | ✗ 不推荐 | ✓ 推荐 |
| **break/continue** | ✓ 支持 | ✓ 支持 |

### 🎯 面试高频问题

1. **for...in 和 for...of 的区别？**
   → in 遍历键，of 遍历值；in 会遍历原型链，of 依赖 Iterator

2. **为什么 for...of 不能遍历普通对象？**
   → 普通对象没有实现 Iterator 接口

3. **如何让普通对象可以用 for...of？**
   → 实现 [Symbol.iterator] 方法，或用 Object.keys/values/entries 转换

4. **遍历数组用哪个更好？**
   → for...of 更好，直接拿值，不会遍历自定义属性

5. **for...in 遍历数组有什么问题？**
   → 索引是字符串，会遍历原型链和自定义属性

---

## 🔑 核心奥义

> **一句话记住区别：**
>
> | | for...in | for...of |
> |---|---|---|
> | **比喻** | 🔑 找钥匙（key） | 📦 取东西（value） |
> | **机制** | 可枚举属性 + 原型链 | Iterator 迭代器 |
> | **适用** | 对象属性 | 数组/字符串/Map/Set |
>
> **in 看门牌，of 拿快递！**