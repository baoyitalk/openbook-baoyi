# CSS 多行文本溢出省略 - 第一性原理完全指南

> 🎯 **面试高频指数：★★★☆☆**

---

## 📚 目录

1. [第一性原理：什么是文本溢出？](#第一性原理什么是文本溢出)
2. [单行文本溢出（基础回顾）](#单行文本溢出基础回顾)
3. [多行文本溢出方案](#多行文本溢出方案)
4. [方案对比与选型](#方案对比与选型)
5. [经典面试代码](#经典面试代码)
6. [核心奥义](#核心奥义)

---

## 第一性原理：什么是文本溢出？

### 🧠 本质思考

**文本溢出的本质 = 内容超出了容器的可视边界**

```
问题场景：
┌─────────────────────────────┐
│  这是一段很长很长很长的文本   │ ← 容器有限
│  内容继续继续继续继续继续...  │
│  还有更多内容溢出到容器外面！ │ ← 溢出部分
└─────────────────────────────┘
         ↓ 超出部分怎么处理？

解决目标：
┌─────────────────────────────┐
│  这是一段很长很长的文本内容   │
│  继续继续继续继续继续继续...  │
│  还有更多内容...             │ ← 省略号提示
└─────────────────────────────┘
```

### 🔑 核心问题拆解

| 问题 | 本质 | 解决思路 |
|------|------|----------|
| **如何隐藏溢出？** | 容器边界控制 | `overflow: hidden` |
| **如何显示省略号？** | 视觉提示截断 | `...` 或 `text-overflow: ellipsis` |
| **如何控制行数？** | 多行边界计算 | 高度限制 或 `-webkit-line-clamp` |

---

## 单行文本溢出（基础回顾）

### 💡 经典三件套

```css
.single-line {
    white-space: nowrap;      /* 1. 不换行 */
    overflow: hidden;         /* 2. 溢出隐藏 */
    text-overflow: ellipsis;  /* 3. 省略号 */
}
```

### 📐 原理图解

```
原始状态（允许换行）：
┌─────────────────────────────┐
│  这是一段很长的文本内容      │
│  会自动换行到下一行          │
└─────────────────────────────┘

Step 1: white-space: nowrap（禁止换行）
┌─────────────────────────────┐
│  这是一段很长的文本内容会自动换行到下一行
└─────────────────────────────┘
                              ↑ 文本超出容器

Step 2: overflow: hidden（隐藏溢出）
┌─────────────────────────────┐
│  这是一段很长的文本内容      │← 溢出部分被隐藏
└─────────────────────────────┘

Step 3: text-overflow: ellipsis（显示省略号）
┌─────────────────────────────┐
│  这是一段很长的文本内容...   │← 省略号提示
└─────────────────────────────┘
```

> ⚠️ **注意**：单行省略非常简单，但 `text-overflow: ellipsis` 对多行无效！

---

## 多行文本溢出方案

### 📐 问题的复杂性

```
为什么多行省略更难？

单行：只需判断一行是否溢出
┌────────────────────────────────────┐
│  文本内容...                        │ ← 一条线
└────────────────────────────────────┘

多行：需要计算"第N行末尾"在哪里
┌────────────────────────────────────┐
│  这是第一行文本内容继续继续         │
│  这是第二行文本内容继续继续         │
│  这是第三行文本内容...   ← 在这里截断│
│  第四行及后面的内容需要隐藏         │ ← 需要隐藏
└────────────────────────────────────┘
         ↑
    如何精准找到这个位置？
```

---

### 方法一：定位 + 伪元素遮盖末尾文字

#### 💡 核心思想

**用一个带省略号的伪元素，定位到文本末尾，遮盖住最后的文字**

#### 📐 原理图解

```
Step 1: 设置容器基础样式
┌────────────────────────────────────┐
│  overflow: hidden     ← 溢出隐藏    │
│  line-height: 20px    ← 行高固定    │
│  height: 60px         ← 高度=行高×行数│
│  (60px = 20px × 3行)                │
│                                     │
│  这是第一行文本内容                  │
│  这是第二行文本内容                  │
│  这是第三行文本内容内容              │
│  第四行被隐藏了...                  │ ← hidden
└────────────────────────────────────┘

Step 2: 创建伪元素 ::after
┌────────────────────────────────────┐
│  这是第一行文本内容                  │
│  这是第二行文本内容                  │
│  这是第三行文本内容内 ┌─────┐        │
│                      │ ... │ ← 伪元素│
│  position: absolute  └─────┘        │
│  right: 0; bottom: 0; ← 定位右下角  │
└────────────────────────────────────┘

Step 3: 伪元素遮盖文字
┌────────────────────────────────────┐
│  这是第一行文本内容                  │
│  这是第二行文本内容                  │
│  这是第三行文本内容...               │
│                      ↑              │
│                 背景色遮盖原文字      │
│                 然后显示 "..."       │
└────────────────────────────────────┘
```

#### 🔑 关键属性详解

**给父元素设置：**

```css
.container {
    overflow: hidden;        /* 溢出隐藏 */
    line-height: 20px;       /* 设置行高与容器高度成倍数关系，
                               避免文本溢出时，文字显示一半 */
    height: 60px;            /* 高度 = 行高 × 显示行数 */
    text-align: justify;     /* 设置文本对齐方式为两端对齐，
                               这样在伪元素内容遮盖末尾文字时才能对齐 */
    position: relative;      /* 子绝父相，为伪元素设置定位 */
}
```

**给父元素设置伪元素 ::after：**

```css
.container::after {
    content: "...";          /* 省略号是放在文本最后面的 */
    width: 1em;              /* 设置伪元素的宽度为1em，
                               是为了遮盖的时候正好遮盖中原来的一个字的大小 */
    background-color: pink;  /* 设置与父元素相同的背景颜色，
                               同理，也是为了和原来的内容样式保持一致 */
    position: absolute;      /* 设置定位，其位置就是文本的右下角 */
    right: 0;
    bottom: 0;
}
```

#### ⚠️ 缺点

```
问题1: 背景色必须与容器一致
┌────────────────────────────────────┐
│  如果背景是渐变或图片...             │
│                      ┌─────┐       │
│                      │███...│ ← 穿帮！│
│                      └─────┘       │
└────────────────────────────────────┘

问题2: 文字不足时也会显示省略号
┌────────────────────────────────────┐
│  短文本                             │
│                                     │
│                      ...            │ ← 不应该显示
└────────────────────────────────────┘
```

---

### 方法二：利用旧版弹性盒（-webkit-box）

#### 💡 核心思想

**使用 WebKit 的 CSS 扩展属性，原生支持多行文本截断**

#### 📐 原理图解

```
WebKit 弹性盒的魔法：

display: -webkit-box    ← 开启旧版弹性盒
         ↓
┌────────────────────────────────────┐
│  -webkit-box-orient: vertical      │
│  ↓ 弹性盒子元素垂直排列             │
│  ┌──────────────────────────────┐  │
│  │ 第一行内容                    │  │
│  ├──────────────────────────────┤  │
│  │ 第二行内容                    │  │
│  ├──────────────────────────────┤  │
│  │ 第三行内容...                 │  │ ← line-clamp: 3
│  ├──────────────────────────────┤  │
│  │ 第四行（隐藏）                 │  │ ← overflow: hidden
│  └──────────────────────────────┘  │
└────────────────────────────────────┘
```

#### 🔑 关键属性详解

```css
.box {
    display: -webkit-box;           /* 1. 旧版弹性盒 */
    -webkit-box-orient: vertical;   /* 2. 弹性盒子元素垂直排列 */
    -webkit-line-clamp: 3;          /* 3. 控制要显示的行数 */
    overflow: hidden;               /* 4. 溢出隐藏 */
}
```

#### 📝 完整代码实现

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        /* 多行文本溢出隐藏显示省略号方法二：
           兼容性写法，因使用了WebKit的CSS扩展属性，该方法适用于WebKit浏览器及移动端
        */
        .box {
            width: 200px;
            /* height: 100px; 如果设置了高度，且高度超过文本显示行数，
               在第三行会正常出现省略号，但是三行之后的内容也会显示 */
            background-color: pink;
            /* 设置高度是行高的倍数，防止文本露出一半 */
            line-height: 20px;
            /* 旧版弹性盒 */
            display: -webkit-box;
            /* 弹性盒子元素垂直排列 */
            -webkit-box-orient: vertical;
            /* 控制要显示的行数 */
            -webkit-line-clamp: 3;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div class="box">
        我是文本我是文本我是文本我是文我是文我是文我是文我是文我是文我是是文本我是文本我是文本我是文本
    </div>
</body>
</html>
```

#### 💎 四步口诀

```
┌─────────────────────────────────────────────────┐
│                                                 │
│   1️⃣  display: -webkit-box       → 开启弹性盒   │
│                                                 │
│   2️⃣  -webkit-box-orient: vertical → 垂直排列   │
│                                                 │
│   3️⃣  -webkit-line-clamp: N      → 限制N行     │
│                                                 │
│   4️⃣  overflow: hidden           → 溢出隐藏    │
│                                                 │
└─────────────────────────────────────────────────┘
```

#### ⚠️ 兼容性说明

```
┌────────────────────────────────────────────────┐
│                  兼容性矩阵                      │
├──────────────┬──────────────┬──────────────────┤
│    浏览器     │   支持情况    │      说明        │
├──────────────┼──────────────┼──────────────────┤
│   Chrome     │      ✅      │    完美支持       │
│   Safari     │      ✅      │    完美支持       │
│   Firefox    │      ⚠️      │ 需要额外 polyfill │
│   IE         │      ❌      │    不支持         │
│   Edge       │      ✅      │    基于Chromium   │
│   移动端      │      ✅      │    推荐使用       │
└──────────────┴──────────────┴──────────────────┘
```

> 💡 **专家建议**：如果需要兼容性，使用方法一；如果用户使用 Chrome 或 Safari，使用方法二

---

## 方案对比与选型

### 📊 全面对比表

| 方案 | 原理 | 兼容性 | 优点 | 缺点 |
|------|------|--------|------|------|
| **伪元素遮盖** | 定位+背景遮盖 | ✅ 全兼容 | 兼容所有浏览器 | 背景必须纯色，文字少时也显示 |
| **-webkit-line-clamp** | WebKit扩展 | ⚠️ WebKit系 | 原生支持，代码简洁 | 非WebKit浏览器不支持 |

### 🎯 选型决策树

```
                    ┌─────────────────────┐
                    │  需要兼容 IE/Firefox？│
                    └──────────┬──────────┘
                               │
            ┌──────────────────┴──────────────────┐
            ↓ 是                                   ↓ 否
    ┌───────────────────┐               ┌───────────────────┐
    │ 方法一：伪元素遮盖  │               │  主要用户是移动端？ │
    │ (全兼容方案)       │               └─────────┬─────────┘
    └───────────────────┘                         │
                                  ┌───────────────┴───────────────┐
                                  ↓ 是                             ↓ 否
                          ┌───────────────────┐         ┌───────────────────┐
                          │ 方法二：line-clamp │         │ 方法二：line-clamp │
                          │ (推荐！简洁高效)   │         │ (现代浏览器首选)   │
                          └───────────────────┘         └───────────────────┘
```

---

## 经典面试代码

### 🔥 单行文本溢出（必会）

```css
.single-ellipsis {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
```

### 🔥 多行文本溢出 - 方法一：伪元素版（兼容性好）

```html
<!DOCTYPE html>
<html>
<head>
    <style>
        .multi-ellipsis-v1 {
            position: relative;
            width: 300px;
            height: 60px;          /* 行高 × 行数 */
            line-height: 20px;
            overflow: hidden;
            text-align: justify;
            background-color: #f5f5f5;
        }
        .multi-ellipsis-v1::after {
            content: "...";
            position: absolute;
            right: 0;
            bottom: 0;
            width: 1em;
            background-color: #f5f5f5; /* 与父元素背景色一致 */
        }
    </style>
</head>
<body>
    <div class="multi-ellipsis-v1">
        这是一段很长很长的文本内容，用来测试多行文本溢出省略效果。
        这是一段很长很长的文本内容，用来测试多行文本溢出省略效果。
        这是一段很长很长的文本内容，用来测试多行文本溢出省略效果。
    </div>
</body>
</html>
```

### 🔥 多行文本溢出 - 方法二：line-clamp版（推荐）

```html
<!DOCTYPE html>
<html>
<head>
    <style>
        .multi-ellipsis-v2 {
            width: 300px;
            line-height: 1.5;
            background-color: #e8f4f8;
            
            /* 核心四行代码 */
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 3;      /* 显示3行 */
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div class="multi-ellipsis-v2">
        这是一段很长很长的文本内容，用来测试多行文本溢出省略效果。
        这是一段很长很长的文本内容，用来测试多行文本溢出省略效果。
        这是一段很长很长的文本内容，用来测试多行文本溢出省略效果。
    </div>
</body>
</html>
```

### 🔥 终极方案：兼容性封装

```css
/* 通用多行省略 mixin 思路 */
.multi-line-ellipsis {
    overflow: hidden;
    line-height: 1.5;
    
    /* 方法二：WebKit浏览器 */
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 3;
}

/* 非WebKit浏览器降级方案 */
@supports not (-webkit-line-clamp: 3) {
    .multi-line-ellipsis {
        position: relative;
        max-height: 4.5em;  /* line-height × 行数 */
    }
    .multi-line-ellipsis::after {
        content: "...";
        position: absolute;
        right: 0;
        bottom: 0;
        background: inherit;
    }
}
```

---

## 核心奥义

```
╔═══════════════════════════════════════════════════════════════════╗
║                                                                   ║
║   🎯 一句话总结：                                                  ║
║                                                                   ║
║   单行省略靠"三剑客"（nowrap + hidden + ellipsis），               ║
║   多行省略首选 -webkit-line-clamp 四件套，                         ║
║   兼容老浏览器用伪元素"障眼法"，背景色遮盖显神通！                   ║
║                                                                   ║
╚═══════════════════════════════════════════════════════════════════╝
```

---

## 📋 速记卡片

```
┌─────────────────────────────────────────────────────────────┐
│                      CSS 文本省略速记                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  【单行省略】                                                │
│   white-space: nowrap;                                      │
│   overflow: hidden;                                         │
│   text-overflow: ellipsis;                                  │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  【多行省略 - 推荐】                                         │
│   display: -webkit-box;                                     │
│   -webkit-box-orient: vertical;                             │
│   -webkit-line-clamp: 3;   /* 行数 */                       │
│   overflow: hidden;                                         │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  【多行省略 - 兼容】                                         │
│   父: position: relative; overflow: hidden;                 │
│      height: 行高×行数; line-height: 固定值;                 │
│   ::after: content:"..."; position: absolute;               │
│           right:0; bottom:0; background: 同父元素;           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

> 📝 **作者提示**：本文基于 LeetBook 第七章内容整理，建议配合实际代码练习效果更佳！