# å›¾ç‰‡æ‡’åŠ è½½ - ç¬¬ä¸€æ€§åŸç†å®Œå…¨æŒ‡å—

> ğŸ¯ **é¢è¯•é«˜é¢‘æŒ‡æ•°ï¼šâ˜…â˜…â˜…â˜…â˜†**
> 
> ğŸ“ **æ³¨ï¼šæ­¤é¢˜é€‚åˆå‰ç«¯å¼€å‘ç»éªŒ 1~2 å¹´çš„åŒå­¦å­¦ä¹ **

---

## ğŸ“š ç›®å½•

1. [ç¬¬ä¸€æ€§åŸç†ï¼šä»€ä¹ˆæ˜¯æ‡’åŠ è½½ï¼Ÿ](#ç¬¬ä¸€æ€§åŸç†ä»€ä¹ˆæ˜¯æ‡’åŠ è½½)
2. [å®ç°æ–¹æ¡ˆæ¦‚è§ˆ](#å®ç°æ–¹æ¡ˆæ¦‚è§ˆ)
3. [æ–¹æ³•ä¸€ï¼šscrollTop + offsetTop + innerHeight](#æ–¹æ³•ä¸€scrolltop--offsettop--innerheight)
4. [æ–¹æ³•äºŒï¼šgetBoundingClientRect()](#æ–¹æ³•äºŒgetboundingclientrect)
5. [æ–¹æ³•ä¸‰ï¼šIntersectionObserver](#æ–¹æ³•ä¸‰intersectionobserver)
6. [æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰å‹](#æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰å‹)
7. [ç»å…¸é¢è¯•ä»£ç ](#ç»å…¸é¢è¯•ä»£ç )
8. [æ ¸å¿ƒå¥¥ä¹‰](#æ ¸å¿ƒå¥¥ä¹‰)

---

## ç¬¬ä¸€æ€§åŸç†ï¼šä»€ä¹ˆæ˜¯æ‡’åŠ è½½ï¼Ÿ

### ğŸ§  æœ¬è´¨æ€è€ƒ

**æ‡’åŠ è½½çš„æœ¬è´¨ = å»¶è¿ŸåŠ è½½ = åªåœ¨éœ€è¦æ—¶æ‰åŠ è½½èµ„æº**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ä¼ ç»ŸåŠ è½½æ–¹å¼                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   é¡µé¢åŠ è½½æ—¶ï¼Œä¸€æ¬¡æ€§è¯·æ±‚æ‰€æœ‰å›¾ç‰‡                                  â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”              â”‚
â”‚   â”‚ img1â”‚ â”‚ img2â”‚ â”‚ img3â”‚ â”‚ img4â”‚ â”‚ img5â”‚ â”‚ img6â”‚              â”‚
â”‚   â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜              â”‚
â”‚      â”‚       â”‚       â”‚       â”‚       â”‚       â”‚                  â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                         â†“                                       â”‚
â”‚              åŒæ—¶å‘èµ· 6 ä¸ª HTTP è¯·æ±‚                             â”‚
â”‚              ç”¨æˆ·å¯èƒ½åªçœ‹ç¬¬ 1 å¼ å›¾å°±ç¦»å¼€äº†                        â”‚
â”‚              æµªè´¹å¸¦å®½ï¼æµªè´¹æ€§èƒ½ï¼                                 â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         æ‡’åŠ è½½æ–¹å¼                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   åªåŠ è½½å¯è§†åŒºåŸŸå†…çš„å›¾ç‰‡ï¼Œæ»šåŠ¨åˆ°æ—¶å†åŠ è½½                          â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚   â”‚         å¯è§†åŒºåŸŸ              â”‚                              â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”           â”‚  â† ç«‹å³åŠ è½½                   â”‚
â”‚   â”‚   â”‚ img1â”‚ â”‚ img2â”‚           â”‚                              â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜           â”‚                              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”                              â”‚
â”‚   â”‚ å ä½â”‚ â”‚ å ä½â”‚ â”‚ å ä½â”‚ â”‚ å ä½â”‚  â† æ»šåŠ¨åˆ°æ—¶å†åŠ è½½              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                                                 â”‚
â”‚   æŒ‰éœ€åŠ è½½ï¼ŒèŠ‚çœå¸¦å®½ï¼Œæå‡é¦–å±é€Ÿåº¦ï¼                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ¯ æ‡’åŠ è½½è§£å†³çš„é—®é¢˜

| é—®é¢˜ | æ‡’åŠ è½½å¦‚ä½•è§£å†³ |
|------|---------------|
| **é¦–å±åŠ è½½æ…¢** | åªåŠ è½½å¯è§†åŒºåŸŸå›¾ç‰‡ï¼Œå‡å°‘åˆå§‹è¯·æ±‚ |
| **å¸¦å®½æµªè´¹** | ç”¨æˆ·æœªçœ‹åˆ°çš„å›¾ç‰‡ä¸åŠ è½½ |
| **æœåŠ¡å™¨å‹åŠ›** | åˆ†æ•£è¯·æ±‚ï¼Œé™ä½å¹¶å‘ |
| **ç”¨æˆ·ä½“éªŒ** | é¦–å±æ›´å¿«å‘ˆç°ï¼Œæ¸è¿›å¼åŠ è½½ |

### ğŸ”‘ å®ç°æ‡’åŠ è½½çš„æ ¸å¿ƒé—®é¢˜

```
æ ¸å¿ƒé—®é¢˜ï¼šå¦‚ä½•åˆ¤æ–­å›¾ç‰‡è¿›å…¥å¯è§†åŒºåŸŸï¼Ÿ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                    â”‚    æµè§ˆå™¨è§†å£      â”‚                        â”‚
â”‚  scrollTop         â”‚   (å¯è§†åŒºåŸŸ)       â”‚  innerHeight          â”‚
â”‚  (å·²æ»šåŠ¨è·ç¦»)       â”‚                   â”‚  (è§†å£é«˜åº¦)            â”‚
â”‚       â”‚            â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚      â”‚                 â”‚
â”‚       â”‚            â”‚   â”‚  å›¾ç‰‡   â”‚     â”‚      â”‚                 â”‚
â”‚       â†“            â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚      â†“                 â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•     â”‚                   â”‚                        â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                             â”‚                                   â”‚
â”‚                             â”‚ offsetTop                         â”‚
â”‚                             â”‚ (å…ƒç´ è·ç¦»é¡¶éƒ¨)                     â”‚
â”‚                             â†“                                   â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                        â”‚ å¾…åŠ è½½å›¾ â”‚                              â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                                                 â”‚
â”‚   åˆ¤æ–­æ¡ä»¶ï¼šoffsetTop < scrollTop + innerHeight                  â”‚
â”‚   å³ï¼šå…ƒç´ é¡¶éƒ¨ < å·²æ»šåŠ¨è·ç¦» + è§†å£é«˜åº¦                            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®ç°æ–¹æ¡ˆæ¦‚è§ˆ

### ğŸ“‹ ä¸‰ç§æ–¹æ¡ˆ

| æ–¹æ³• | åŸç† | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|------|
| **scrollTop + offsetTop** | è®¡ç®—å…ƒç´ ä½ç½®ä¸æ»šåŠ¨è·ç¦» | å…¼å®¹æ€§å¥½ | éœ€è¦ç›‘å¬æ»šåŠ¨äº‹ä»¶ |
| **getBoundingClientRect** | è·å–å…ƒç´ ç›¸å¯¹è§†å£ä½ç½® | API æ›´ç›´è§‚ | éœ€è¦ç›‘å¬æ»šåŠ¨äº‹ä»¶ |
| **IntersectionObserver** | æµè§ˆå™¨åŸç”Ÿè§‚å¯Ÿè€… API | æ€§èƒ½æœ€å¥½ï¼Œæ— éœ€ç›‘å¬æ»šåŠ¨ | å…¼å®¹æ€§ç¨å·® |

---

## æ–¹æ³•ä¸€ï¼šscrollTop + offsetTop + innerHeight

### ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ

| å±æ€§ | å«ä¹‰ |
|------|------|
| **scrollTop** | ç½‘é¡µå…ƒç´ è¢«æ»šåŠ¨æ¡å·å»çš„éƒ¨åˆ† |
| **offsetTop** | å…ƒç´ ç›¸å¯¹çˆ¶å…ƒç´ çš„ä½ç½® |
| **innerHeight** | å½“å‰æµè§ˆå™¨çª—å£çš„å¤§å°ï¼ˆéœ€è¦æ³¨æ„å…¼å®¹æ€§é—®é¢˜ï¼‰|

### ğŸ“ åŸç†å›¾è§£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        scrollTop + offsetTop + innerHeight       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   é¡µé¢é¡¶éƒ¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”‚
â”‚        â”‚                                                        â”‚
â”‚        â”‚  scrollTopï¼ˆå·²æ»šåŠ¨çš„é«˜åº¦ï¼‰                              â”‚
â”‚        â”‚                                                        â”‚
â”‚        â†“                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â† è§†å£é¡¶éƒ¨         â”‚
â”‚   â”‚              å¯è§†åŒºåŸŸ                    â”‚                   â”‚
â”‚   â”‚                                         â”‚                   â”‚
â”‚   â”‚         innerHeightï¼ˆè§†å£é«˜åº¦ï¼‰          â”‚                   â”‚
â”‚   â”‚                                         â”‚                   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚                   â”‚
â”‚   â”‚   â”‚         å›¾ç‰‡               â”‚ â†â”€â”€â”€â”€â”€â”€ â”‚ â† å½“å›¾ç‰‡çš„         â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   offsetTop <      â”‚
â”‚   â”‚                                         â”‚   scrollTop +      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   innerHeight      â”‚
â”‚        â†‘                                        æ—¶ï¼ŒåŠ è½½å›¾ç‰‡      â”‚
â”‚        â””â”€ è§†å£åº•éƒ¨                                               â”‚
â”‚                                                                 â”‚
â”‚   ã€åˆ¤æ–­å…¬å¼ã€‘                                                   â”‚
â”‚   img.offsetTop < document.documentElement.scrollTop +          â”‚
â”‚                   window.innerHeight                            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“ å®Œæ•´ä»£ç å®ç°

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾ç‰‡æ‡’åŠ è½½ - scrollTopæ–¹æ¡ˆ</title>
    <style>
        img {
            background: url('./img/loading.gif') no-repeat center;
            width: 250px;
            height: 250px;
            display: block;
        }
    </style>
</head>
<body>
    <!-- ä½¿ç”¨å ä½å›¾ï¼ŒçœŸå®åœ°å€å­˜åœ¨ data-url ä¸­ -->
    <img src="./img/pixel.gif" data-url="./img/1.jpeg">
    <img src="./img/pixel.gif" data-url="./img/2.jfif">
    <img src="./img/pixel.gif" data-url="./img/3.jfif">
    <img src="./img/pixel.gif" data-url="./img/4.jfif">
    <img src="./img/pixel.gif" data-url="./img/5.jfif">
    <img src="./img/pixel.gif" data-url="./img/6.webp">

    <script>
        let imgs = document.getElementsByTagName('img')
        
        // æ‡’åŠ è½½æ ¸å¿ƒå‡½æ•°
        function lazyLoad() {
            // è·å–æ»šåŠ¨è·ç¦»ï¼ˆå…¼å®¹å†™æ³•ï¼‰
            let scrollTop = document.documentElement.scrollTop || document.body.scrollTop
            // è·å–è§†å£é«˜åº¦ï¼ˆå…¼å®¹å†™æ³•ï¼‰
            let clientHeight = window.innerHeight || document.documentElement.clientHeight
            
            for (let i = 0; i < imgs.length; i++) {
                // åˆ¤æ–­å›¾ç‰‡æ˜¯å¦è¿›å…¥å¯è§†åŒºåŸŸ
                if (imgs[i].offsetTop < scrollTop + clientHeight) {
                    // å°† data-url çš„å€¼èµ‹ç»™ srcï¼Œè§¦å‘çœŸå®åŠ è½½
                    imgs[i].src = imgs[i].getAttribute('data-url')
                }
            }
        }
        
        // 1. é¡µé¢åŠ è½½ç«‹å³æ‰§è¡Œä¸€æ¬¡
        lazyLoad()
        
        // 2. ç›‘å¬æ»šåŠ¨äº‹ä»¶
        window.addEventListener('scroll', lazyLoad)
    </script>
</body>
</html>
```

### âš ï¸ æ³¨æ„äº‹é¡¹

> **æ€§èƒ½é—®é¢˜**ï¼šæ»šåŠ¨äº‹ä»¶è§¦å‘é¢‘ç‡å¾ˆé«˜ï¼Œå»ºè®®é…åˆ**èŠ‚æµå‡½æ•°**ä½¿ç”¨

```javascript
// èŠ‚æµç‰ˆæœ¬
function throttle(fn, delay) {
    let timer = null
    return function() {
        if (timer) return
        timer = setTimeout(() => {
            fn.apply(this, arguments)
            timer = null
        }, delay)
    }
}

window.addEventListener('scroll', throttle(lazyLoad, 200))
```

---

## æ–¹æ³•äºŒï¼šgetBoundingClientRect()

### ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ

`getBoundingClientRect()` è¿”å›å…ƒç´ ç›¸å¯¹äºè§†å£çš„ä½ç½®ä¿¡æ¯ï¼š

| å±æ€§ | å«ä¹‰ |
|------|------|
| **rectObject.top** | å…ƒç´ ä¸Šè¾¹åˆ°è§†çª—ä¸Šè¾¹çš„è·ç¦» |
| **rectObject.right** | å…ƒç´ å³è¾¹åˆ°è§†çª—å·¦è¾¹çš„è·ç¦» |
| **rectObject.bottom** | å…ƒç´ ä¸‹è¾¹åˆ°è§†çª—ä¸Šè¾¹çš„è·ç¦» |
| **rectObject.left** | å…ƒç´ å·¦è¾¹åˆ°è§†çª—å·¦è¾¹çš„è·ç¦» |
| **rectObject.width** | å…ƒç´ è‡ªèº«çš„å®½åº¦ |
| **rectObject.height** | å…ƒç´ è‡ªèº«çš„é«˜åº¦ |

### ğŸ“ åŸç†å›¾è§£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    getBoundingClientRect() è¯¦è§£                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   è§†å£å·¦ä¸Šè§’ (0, 0)                                              â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚        â”‚                                          â”‚             â”‚
â”‚        â”‚    left                                  â”‚             â”‚
â”‚        â”‚  â†â”€â”€â”€â”€â†’                                  â”‚             â”‚
â”‚        â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚             â”‚
â”‚        â”‚   top  â”‚                 â”‚               â”‚             â”‚
â”‚        â”‚    â†‘   â”‚     å…ƒç´         â”‚ width         â”‚             â”‚
â”‚        â”‚    â”‚   â”‚                 â”‚â†â”€â”€â”€â”€â†’         â”‚             â”‚
â”‚        â”‚    â†“   â”‚                 â”‚               â”‚             â”‚
â”‚        â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚             â”‚
â”‚        â”‚              â†‘                           â”‚             â”‚
â”‚        â”‚              â”‚ height                    â”‚             â”‚
â”‚        â”‚              â†“                           â”‚             â”‚
â”‚        â”‚        bottom (å…ƒç´ åº•éƒ¨åˆ°è§†å£é¡¶éƒ¨çš„è·ç¦»)    â”‚             â”‚
â”‚        â”‚                                          â”‚             â”‚
â”‚        â”‚                     innerHeight          â”‚             â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                 â”‚
â”‚   ã€åˆ¤æ–­æ¡ä»¶ã€‘                                                   â”‚
â”‚   img.getBoundingClientRect().top < window.innerHeight          â”‚
â”‚   å³ï¼šå…ƒç´ é¡¶éƒ¨åˆ°è§†å£é¡¶éƒ¨çš„è·ç¦» < è§†å£é«˜åº¦                          â”‚
â”‚   ï¼ˆè¯´æ˜å…ƒç´ å·²ç»è¿›å…¥å¯è§†åŒºåŸŸï¼‰                                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“ å®Œæ•´ä»£ç å®ç°

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾ç‰‡æ‡’åŠ è½½ - getBoundingClientRectæ–¹æ¡ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }
        img {
            background: url('./img/loading.gif') no-repeat center;
            width: 250px;
            height: 250px;
            display: block;
        }
    </style>
</head>
<body>
    <img src="./img/pixel.gif" data-url="./img/1.jpeg">
    <img src="./img/pixel.gif" data-url="./img/2.jfif">
    <img src="./img/pixel.gif" data-url="./img/3.jfif">
    <img src="./img/pixel.gif" data-url="./img/4.jfif">
    <img src="./img/pixel.gif" data-url="./img/5.jfif">
    <img src="./img/pixel.gif" data-url="./img/6.webp">

    <script>
        let imgs = document.getElementsByTagName('img')
        
        function lazyLoad() {
            let clientHeight = window.innerHeight
            
            for (let i = 0; i < imgs.length; i++) {
                // ä½¿ç”¨ getBoundingClientRect è·å–å…ƒç´ ä½ç½®
                let rect = imgs[i].getBoundingClientRect()
                
                // åˆ¤æ–­å…ƒç´ æ˜¯å¦è¿›å…¥å¯è§†åŒºåŸŸ
                if (rect.top < clientHeight) {
                    imgs[i].src = imgs[i].getAttribute('data-url')
                }
            }
        }
        
        // é¡µé¢åŠ è½½ç«‹å³æ‰§è¡Œ
        lazyLoad()
        
        // ç›‘å¬æ»šåŠ¨
        window.addEventListener('scroll', lazyLoad)
    </script>
</body>
</html>
```

### ğŸ’ ç›¸æ¯”æ–¹æ³•ä¸€çš„ä¼˜åŠ¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚   æ–¹æ³•ä¸€ (offsetTop)        vs        æ–¹æ³•äºŒ (getBoundingClientRect) â”‚
â”‚                                                                 â”‚
â”‚   éœ€è¦è®¡ç®—ï¼š                           ç›´æ¥è·å–ï¼š                â”‚
â”‚   scrollTop + offsetTop               rect.top å°±æ˜¯åˆ°è§†å£çš„è·ç¦»  â”‚
â”‚                                                                 â”‚
â”‚   å—çˆ¶å…ƒç´ å®šä½å½±å“                      å§‹ç»ˆç›¸å¯¹äºè§†å£è®¡ç®—         â”‚
â”‚                                                                 â”‚
â”‚   éœ€è¦å…¼å®¹æ€§å¤„ç†                        API æ›´ç°ä»£ï¼Œè¯­ä¹‰æ›´æ¸…æ™°     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ–¹æ³•ä¸‰ï¼šIntersectionObserver

### ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ

- **IntersectionObserver**ï¼šæµè§ˆå™¨åŸç”Ÿæä¾›çš„æ„é€ å‡½æ•°ï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•°
- **IntersectionObserver API æ˜¯å¼‚æ­¥çš„**ï¼Œä¸ä¼šä¸ç›®æ ‡å…ƒç´ çš„æ»šåŠ¨åŒæ­¥è§¦å‘
- **æ— éœ€ç›‘å¬ scroll äº‹ä»¶**ï¼Œæ€§èƒ½æ›´å¥½

### ğŸ“ åŸç†å›¾è§£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    IntersectionObserver å·¥ä½œåŸç†                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   ä¼ ç»Ÿæ–¹å¼ï¼ˆæ–¹æ³•ä¸€ã€äºŒï¼‰ï¼š                                        â”‚
â”‚                                                                 â”‚
â”‚   æ»šåŠ¨äº‹ä»¶ â†’ è§¦å‘å›è°ƒ â†’ è®¡ç®—ä½ç½® â†’ åˆ¤æ–­æ˜¯å¦å¯è§ â†’ åŠ è½½å›¾ç‰‡         â”‚
â”‚       â†“                                                         â”‚
â”‚   æ¯æ¬¡æ»šåŠ¨éƒ½è¦æ‰§è¡Œï¼Œæ€§èƒ½æ¶ˆè€—å¤§                                    â”‚
â”‚                                                                 â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                 â”‚
â”‚   IntersectionObserver æ–¹å¼ï¼š                                    â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚   â”‚              æµè§ˆå™¨å†…éƒ¨                   â”‚                   â”‚
â”‚   â”‚                                         â”‚                   â”‚
â”‚   â”‚   Observer è§‚å¯Ÿ â†’ å¼‚æ­¥æ£€æµ‹äº¤å‰çŠ¶æ€        â”‚                   â”‚
â”‚   â”‚        â†“                                â”‚                   â”‚
â”‚   â”‚   å…ƒç´ è¿›å…¥è§†å£æ—¶è‡ªåŠ¨è§¦å‘å›è°ƒ              â”‚                   â”‚
â”‚   â”‚        â†“                                â”‚                   â”‚
â”‚   â”‚   entries åŒ…å«æ‰€æœ‰è¢«è§‚å¯Ÿå…ƒç´ çš„ä¿¡æ¯        â”‚                   â”‚
â”‚   â”‚                                         â”‚                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                 â”‚
â”‚   ä¼˜åŠ¿ï¼š                                                         â”‚
â”‚   âœ“ ä¸éœ€è¦ç›‘å¬ scroll äº‹ä»¶                                       â”‚
â”‚   âœ“ æµè§ˆå™¨çº§åˆ«ä¼˜åŒ–ï¼Œæ€§èƒ½æä½³                                      â”‚
â”‚   âœ“ å¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹                                        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“ å®Œæ•´ä»£ç å®ç°

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾ç‰‡æ‡’åŠ è½½ - IntersectionObserveræ–¹æ¡ˆ</title>
    <style>
        img {
            background: url('./img/loading.gif') no-repeat center;
            width: 250px;
            height: 250px;
            display: block;
        }
    </style>
</head>
<body>
    <img src="./img/pixel.gif" data-url="./img/1.jpeg">
    <img src="./img/pixel.gif" data-url="./img/2.jfif">
    <img src="./img/pixel.gif" data-url="./img/3.jfif">
    <img src="./img/pixel.gif" data-url="./img/4.jfif">
    <img src="./img/pixel.gif" data-url="./img/5.jfif">
    <img src="./img/pixel.gif" data-url="./img/6.webp">

    <script>
        let imgs = document.getElementsByTagName('img')
        
        // åˆ›å»ºè§‚å¯Ÿè€…å®ä¾‹
        let io = new IntersectionObserver(function(entries) {
            // entries æ˜¯æ‰€æœ‰è¢«è§‚å¯Ÿå…ƒç´ çš„æ•°ç»„
            entries.forEach(entry => {
                // isIntersecting ä¸º true è¡¨ç¤ºå…ƒç´ è¿›å…¥å¯è§†åŒºåŸŸ
                if (entry.isIntersecting) {
                    let img = entry.target
                    img.src = img.getAttribute('data-url')
                    
                    // åŠ è½½å®Œæˆååœæ­¢è§‚å¯Ÿè¯¥å…ƒç´ 
                    io.unobserve(img)
                }
            })
        })
        
        // è§‚å¯Ÿæ‰€æœ‰å›¾ç‰‡
        for (let i = 0; i < imgs.length; i++) {
            io.observe(imgs[i])
        }
    </script>
</body>
</html>
```

### ğŸ“ IntersectionObserver API è¯¦è§£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 IntersectionObserver ä½¿ç”¨æ–¹æ³•                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   // 1. åˆ›å»ºè§‚å¯Ÿè€…                                               â”‚
â”‚   let observer = new IntersectionObserver(callback, options)    â”‚
â”‚                                                                 â”‚
â”‚   // callback å‚æ•°ï¼š                                             â”‚
â”‚   function callback(entries, observer) {                        â”‚
â”‚       entries.forEach(entry => {                                â”‚
â”‚           entry.target          // è¢«è§‚å¯Ÿçš„å…ƒç´                   â”‚
â”‚           entry.isIntersecting  // æ˜¯å¦è¿›å…¥å¯è§†åŒºåŸŸ              â”‚
â”‚           entry.intersectionRatio // å¯è§æ¯”ä¾‹ 0~1               â”‚
â”‚       })                                                        â”‚
â”‚   }                                                             â”‚
â”‚                                                                 â”‚
â”‚   // options å‚æ•°ï¼ˆå¯é€‰ï¼‰ï¼š                                       â”‚
â”‚   {                                                             â”‚
â”‚       root: null,        // è§‚å¯Ÿçš„æ ¹å…ƒç´ ï¼Œé»˜è®¤ä¸ºè§†å£              â”‚
â”‚       rootMargin: '0px', // æ ¹å…ƒç´ çš„è¾¹è·                         â”‚
â”‚       threshold: 0       // è§¦å‘å›è°ƒçš„é˜ˆå€¼ï¼Œ0~1                  â”‚
â”‚   }                                                             â”‚
â”‚                                                                 â”‚
â”‚   // 2. å¼€å§‹è§‚å¯Ÿ                                                 â”‚
â”‚   observer.observe(element)                                     â”‚
â”‚                                                                 â”‚
â”‚   // 3. åœæ­¢è§‚å¯Ÿ                                                 â”‚
â”‚   observer.unobserve(element)                                   â”‚
â”‚                                                                 â”‚
â”‚   // 4. å…³é—­è§‚å¯Ÿè€…                                               â”‚
â”‚   observer.disconnect()                                         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰å‹

### ğŸ“Š å…¨é¢å¯¹æ¯”è¡¨

| å¯¹æ¯”é¡¹ | scrollTop + offsetTop | getBoundingClientRect | IntersectionObserver |
|--------|----------------------|----------------------|---------------------|
| **åŸç†** | è®¡ç®—æ»šåŠ¨è·ç¦»ä¸å…ƒç´ ä½ç½® | è·å–å…ƒç´ ç›¸å¯¹è§†å£ä½ç½® | æµè§ˆå™¨åŸç”Ÿè§‚å¯Ÿè€… |
| **æ€§èƒ½** | â­â­ | â­â­ | â­â­â­â­â­ |
| **ä»£ç å¤æ‚åº¦** | ä¸­ç­‰ | ç®€å• | æœ€ç®€å• |
| **å…¼å®¹æ€§** | âœ… IE6+ | âœ… IE9+ | âš ï¸ IE ä¸æ”¯æŒ |
| **éœ€è¦èŠ‚æµ** | æ˜¯ | æ˜¯ | å¦ |
| **ç›‘å¬æ»šåŠ¨** | æ˜¯ | æ˜¯ | å¦ |

### ğŸ¯ é€‰å‹å†³ç­–æ ‘

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   éœ€è¦å…¼å®¹ IEï¼Ÿ      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â†“ æ˜¯                                   â†“ å¦
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ æ–¹æ³•ä¸€æˆ–æ–¹æ³•äºŒ      â”‚               â”‚ æ–¹æ³•ä¸‰              â”‚
    â”‚ + èŠ‚æµå‡½æ•°         â”‚               â”‚ IntersectionObserverâ”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚ (å¼ºçƒˆæ¨èï¼)         â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç»å…¸é¢è¯•ä»£ç 

### ğŸ”¥ æ–¹æ¡ˆä¸€ï¼šscrollTopï¼ˆå¸¦èŠ‚æµï¼‰

```javascript
// èŠ‚æµå‡½æ•°
function throttle(fn, delay = 200) {
    let timer = null
    return function(...args) {
        if (timer) return
        timer = setTimeout(() => {
            fn.apply(this, args)
            timer = null
        }, delay)
    }
}

// æ‡’åŠ è½½å‡½æ•°
function lazyLoad() {
    const imgs = document.querySelectorAll('img[data-src]')
    const scrollTop = document.documentElement.scrollTop || document.body.scrollTop
    const clientHeight = window.innerHeight || document.documentElement.clientHeight
    
    imgs.forEach(img => {
        if (img.offsetTop < scrollTop + clientHeight) {
            img.src = img.dataset.src
            img.removeAttribute('data-src')
        }
    })
}

// åˆå§‹åŒ–
lazyLoad()
window.addEventListener('scroll', throttle(lazyLoad))
```

### ğŸ”¥ æ–¹æ¡ˆäºŒï¼šgetBoundingClientRectï¼ˆå¸¦èŠ‚æµï¼‰

```javascript
function lazyLoad() {
    const imgs = document.querySelectorAll('img[data-src]')
    const clientHeight = window.innerHeight
    
    imgs.forEach(img => {
        const rect = img.getBoundingClientRect()
        // åˆ¤æ–­æ˜¯å¦åœ¨å¯è§†åŒºåŸŸå†…
        if (rect.top < clientHeight && rect.bottom > 0) {
            img.src = img.dataset.src
            img.removeAttribute('data-src')
        }
    })
}

lazyLoad()
window.addEventListener('scroll', throttle(lazyLoad, 200))
```

### ğŸ”¥ æ–¹æ¡ˆä¸‰ï¼šIntersectionObserverï¼ˆæ¨èï¼‰

```javascript
function lazyLoad() {
    const imgs = document.querySelectorAll('img[data-src]')
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target
                img.src = img.dataset.src
                img.removeAttribute('data-src')
                observer.unobserve(img)
            }
        })
    }, {
        rootMargin: '0px 0px 100px 0px' // æå‰ 100px åŠ è½½
    })
    
    imgs.forEach(img => observer.observe(img))
}

lazyLoad()
```

### ğŸ”¥ é€šç”¨ HTML ç»“æ„

```html
<!-- ä½¿ç”¨ data-src å­˜å‚¨çœŸå®å›¾ç‰‡åœ°å€ -->
<img src="placeholder.gif" data-src="real-image.jpg" alt="æ‡’åŠ è½½å›¾ç‰‡">

<!-- æˆ–ä½¿ç”¨ data-url -->
<img src="./img/pixel.gif" data-url="./img/1.jpeg">

<!-- CSS è®¾ç½®åŠ è½½ä¸­çš„èƒŒæ™¯ -->
<style>
img {
    background: url('loading.gif') no-repeat center;
    width: 250px;
    height: 250px;
    display: block;
}
</style>
```

---

## æ ¸å¿ƒå¥¥ä¹‰

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                       â•‘
â•‘   ğŸ¯ ä¸€å¥è¯æ€»ç»“ï¼š                                                      â•‘
â•‘                                                                       â•‘
â•‘   æ‡’åŠ è½½æœ¬è´¨æ˜¯"æŒ‰éœ€åŠ è½½"ï¼Œæ ¸å¿ƒåœ¨äºåˆ¤æ–­å…ƒç´ æ˜¯å¦è¿›å…¥å¯è§†åŒºåŸŸï¼›              â•‘
â•‘   ä¼ ç»Ÿæ–¹æ¡ˆé  scroll ç›‘å¬ + ä½ç½®è®¡ç®—ï¼Œè®°å¾—åŠ èŠ‚æµä¿æ€§èƒ½ï¼›                  â•‘
â•‘   ç°ä»£æ–¹æ¡ˆç”¨ IntersectionObserverï¼Œæµè§ˆå™¨å¸®ä½ ç®—ï¼Œä¼˜é›…åˆé«˜æ•ˆï¼            â•‘
â•‘                                                                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ“‹ é€Ÿè®°å¡ç‰‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å›¾ç‰‡æ‡’åŠ è½½é€Ÿè®°                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ã€HTML ç»“æ„ã€‘                                                   â”‚
â”‚   <img src="å ä½å›¾" data-src="çœŸå®å›¾ç‰‡åœ°å€">                     â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ã€æ–¹æ³•ä¸€ã€‘scrollTop + offsetTop + innerHeight                  â”‚
â”‚   æ¡ä»¶ï¼šimg.offsetTop < scrollTop + innerHeight                 â”‚
â”‚                                                                 â”‚
â”‚  ã€æ–¹æ³•äºŒã€‘getBoundingClientRect()                              â”‚
â”‚   æ¡ä»¶ï¼šimg.getBoundingClientRect().top < innerHeight           â”‚
â”‚                                                                 â”‚
â”‚  ã€æ–¹æ³•ä¸‰ã€‘IntersectionObserverï¼ˆæ¨èï¼‰                          â”‚
â”‚   æ¡ä»¶ï¼šentry.isIntersecting === true                           â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ã€æ€§èƒ½ä¼˜åŒ–ã€‘                                                    â”‚
â”‚   æ–¹æ³•ä¸€ã€äºŒéœ€è¦èŠ‚æµï¼šthrottle(lazyLoad, 200)                    â”‚
â”‚   æ–¹æ³•ä¸‰æ— éœ€èŠ‚æµï¼Œæµè§ˆå™¨è‡ªåŠ¨ä¼˜åŒ–                                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

> ğŸ“ **ä½œè€…æç¤º**ï¼šIntersectionObserver æ˜¯ç°ä»£å‰ç«¯çš„æœ€ä½³å®è·µï¼Œå»ºè®®ä¼˜å…ˆæŒæ¡ï¼