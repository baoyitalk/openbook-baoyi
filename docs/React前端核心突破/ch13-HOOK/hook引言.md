# React Hooks - ç¬¬ä¸€æ€§åŸç†æ·±åº¦æ‹†è§£

## ä¸€ã€ç¬¬ä¸€æ€§åŸç†ï¼šä¸ºä»€ä¹ˆéœ€è¦ Hooksï¼Ÿ

### æœ¬è´¨æ€è€ƒ

React ç»„ä»¶çš„æœ¬è´¨æ˜¯ **UI = f(state)**ï¼Œå³çŠ¶æ€åˆ° UI çš„æ˜ å°„ã€‚Class ç»„ä»¶è™½ç„¶èƒ½å®ç°è¿™ä¸€ç‚¹ï¼Œä½†å­˜åœ¨æ ¹æœ¬æ€§é—®é¢˜ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Class ç»„ä»¶çš„ç—›ç‚¹                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. é€»è¾‘åˆ†æ•£                                                 â”‚
â”‚     ç›¸å…³é€»è¾‘è¢«å¼ºåˆ¶æ‹†åˆ†åˆ°ä¸åŒç”Ÿå‘½å‘¨æœŸ                          â”‚
â”‚     componentDidMount + componentWillUnmount æ‰èƒ½å®Œæˆè®¢é˜…    â”‚
â”‚                                                             â”‚
â”‚  2. å¤ç”¨å›°éš¾                                                 â”‚
â”‚     çŠ¶æ€é€»è¾‘å¤ç”¨éœ€è¦ HOC / render props                      â”‚
â”‚     å¯¼è‡´ç»„ä»¶åµŒå¥—åœ°ç‹±ï¼ˆwrapper hellï¼‰                         â”‚
â”‚                                                             â”‚
â”‚  3. this ç»‘å®š                                                â”‚
â”‚     éœ€è¦æ‰‹åŠ¨ bind æˆ–ç®­å¤´å‡½æ•°ï¼Œæ˜“å‡ºé”™                         â”‚
â”‚                                                             â”‚
â”‚  4. éš¾ä»¥ä¼˜åŒ–                                                 â”‚
â”‚     class ä¸åˆ©äºç¼–è¯‘å™¨ä¼˜åŒ–ï¼ˆå¦‚ Prepack component foldingï¼‰   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Hooks çš„è§£å†³æ–¹æ¡ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Hooks çš„æ ¸å¿ƒç†å¿µ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  "é’©å…¥" React ç‰¹æ€§                                           â”‚
â”‚  åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨ stateã€ç”Ÿå‘½å‘¨æœŸç­‰ React ç‰¹æ€§               â”‚
â”‚                                                             â”‚
â”‚  é€»è¾‘å†…èš                                                    â”‚
â”‚  å°†ç›¸äº’å…³è”çš„é€»è¾‘æ‹†åˆ†æˆæ›´å°çš„å‡½æ•°ï¼Œè€ŒéæŒ‰ç”Ÿå‘½å‘¨æœŸåˆ’åˆ†         â”‚
â”‚                                                             â”‚
â”‚  æ¸è¿›å¼é‡‡ç”¨                                                  â”‚
â”‚  Hook å’Œç°æœ‰ä»£ç å¯ä»¥åŒæ—¶å·¥ä½œï¼Œæ— éœ€é‡å†™å·²æœ‰ç»„ä»¶               â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€æ ¸å¿ƒ Hooks è¯¦è§£

### 1. useState - State Hook

```javascript
const [state, setState] = useState(initialState);
```

**ç‰¹ç‚¹ï¼š**
- å…è®¸åœ¨å‡½æ•°ç»„ä»¶ä¸­æ·»åŠ  state
- å‚æ•°ï¼šåˆå§‹ stateï¼Œæ”¯æŒæ•°å­—ã€å­—ç¬¦ä¸²ã€å¯¹è±¡ç­‰ç±»å‹
- è¿”å›å€¼ï¼šå½“å‰ state + æ›´æ–° state çš„å‡½æ•°ï¼ˆæ•°ç»„è§£æ„ï¼‰
- state åªåœ¨ç»„ä»¶**é¦–æ¬¡æ¸²æŸ“æ—¶åˆ›å»º**ï¼Œåç»­æ¸²æŸ“è¿”å›å½“å‰å€¼

```javascript
function Counter() {
  const [count, setCount] = useState(0);
  
  return (
    <div>
      <p>Count: {count}</p>
      <button onClick={() => setCount(count + 1)}>+1</button>
      <button onClick={() => setCount(prev => prev + 1)}>+1 (å‡½æ•°å¼)</button>
    </div>
  );
}
```

### 2. useEffect - Effect Hook

```javascript
useEffect(() => {
  // å‰¯ä½œç”¨é€»è¾‘
  return () => {
    // æ¸…ç†é€»è¾‘ï¼ˆå¯é€‰ï¼‰
  };
}, [dependencies]);
```

**æ‰§è¡Œæ—¶æœºï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    useEffect æ‰§è¡Œæ—¶æœº                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ç»„ä»¶æ¸²æŸ“ â†’ DOM æ›´æ–° â†’ æµè§ˆå™¨ç»‘åˆ¶ â†’ useEffect æ‰§è¡Œ           â”‚
â”‚                                    ï¼ˆå¼‚æ­¥ï¼Œä¸é˜»å¡ç»‘åˆ¶ï¼‰      â”‚
â”‚                                                             â”‚
â”‚  ä¾èµ–é¡¹å˜åŒ–æ—¶ï¼š                                              â”‚
â”‚  æ‰§è¡Œä¸Šä¸€ä¸ª effect çš„æ¸…ç†å‡½æ•° â†’ æ‰§è¡Œæ–°çš„ effect              â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¾èµ–æ•°ç»„çš„ä¸‰ç§æƒ…å†µï¼š**

| å†™æ³• | æ‰§è¡Œæ—¶æœº | ç­‰ä»·ç”Ÿå‘½å‘¨æœŸ |
|-----|---------|-------------|
| `useEffect(fn)` | æ¯æ¬¡æ¸²æŸ“å | componentDidMount + componentDidUpdate |
| `useEffect(fn, [])` | ä»…æŒ‚è½½æ—¶ | componentDidMount |
| `useEffect(fn, [deps])` | deps å˜åŒ–æ—¶ | componentDidMount + æ¡ä»¶æ€§ componentDidUpdate |

### 3. æ¸…é™¤ Effect çš„å‰¯ä½œç”¨

```javascript
useEffect(() => {
  // æ·»åŠ è®¢é˜…
  const subscription = props.source.subscribe();
  
  // è¿”å›æ¸…ç†å‡½æ•°
  return () => {
    subscription.unsubscribe();
  };
}, [props.source]);
```

**æ¸…ç†æ—¶æœºï¼š**
- ç»„ä»¶å¸è½½æ—¶
- ä¸‹ä¸€æ¬¡ effect æ‰§è¡Œå‰ï¼ˆä¾èµ–å˜åŒ–æ—¶ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Effect æ¸…ç†æµç¨‹                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  é¦–æ¬¡æ¸²æŸ“:  effect1 æ‰§è¡Œ                                     â”‚
â”‚       â†“                                                     â”‚
â”‚  ä¾èµ–å˜åŒ–:  effect1 æ¸…ç† â†’ effect2 æ‰§è¡Œ                      â”‚
â”‚       â†“                                                     â”‚
â”‚  å†æ¬¡å˜åŒ–:  effect2 æ¸…ç† â†’ effect3 æ‰§è¡Œ                      â”‚
â”‚       â†“                                                     â”‚
â”‚  ç»„ä»¶å¸è½½:  effect3 æ¸…ç†                                     â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€Hook ä½¿ç”¨è§„åˆ™

### ä¸¤æ¡æ ¸å¿ƒè§„åˆ™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Hook è§„åˆ™                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  è§„åˆ™1ï¼šåªåœ¨æœ€é¡¶å±‚ä½¿ç”¨ Hook                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ âŒ ä¸è¦åœ¨å¾ªç¯ã€æ¡ä»¶ã€åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨ Hook              â”‚   â”‚
â”‚  â”‚ âœ… ç¡®ä¿ Hook åœ¨æ¯æ¬¡æ¸²æŸ“éƒ½æŒ‰ç›¸åŒé¡ºåºè¢«è°ƒç”¨            â”‚   â”‚
â”‚  â”‚    è¿™æ · React æ‰èƒ½æ­£ç¡®å…³è”å¤šä¸ª useState/useEffect    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  è§„åˆ™2ï¼šåªåœ¨ React å‡½æ•°ä¸­è°ƒç”¨ Hook                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ âœ… React å‡½æ•°ç»„ä»¶                                    â”‚   â”‚
â”‚  â”‚ âœ… è‡ªå®šä¹‰ Hook                                       â”‚   â”‚
â”‚  â”‚ âŒ æ™®é€š JavaScript å‡½æ•°                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸ºä»€ä¹ˆå¿…é¡»æŒ‰é¡ºåºè°ƒç”¨ï¼Ÿ

```javascript
// âŒ é”™è¯¯ï¼šæ¡ä»¶è°ƒç”¨ç ´åé¡ºåº
function Component({ condition }) {
  const [name, setName] = useState('');
  
  if (condition) {
    useEffect(() => { }); // æ¡ä»¶ä¸º false æ—¶ï¼Œåé¢çš„ Hook é¡ºåºå°±ä¹±äº†
  }
  
  const [age, setAge] = useState(0);
}

// âœ… æ­£ç¡®ï¼šæ¡ä»¶æ”¾åœ¨ Hook å†…éƒ¨
function Component({ condition }) {
  const [name, setName] = useState('');
  
  useEffect(() => {
    if (condition) {
      // æ¡ä»¶é€»è¾‘æ”¾è¿™é‡Œ
    }
  });
  
  const [age, setAge] = useState(0);
}
```

### ESLint æ’ä»¶æ ¡éªŒ

```bash
npm install eslint-plugin-react-hooks -D
```

```json
{
  "plugins": ["react-hooks"],
  "rules": {
    "react-hooks/rules-of-hooks": "error",
    "react-hooks/exhaustive-deps": "warn"
  }
}
```

---

## å››ã€å¸¸ç”¨ Hooks å¯¹æ¯”

### useMemo vs useCallback

```javascript
// useMemoï¼šç¼“å­˜è®¡ç®—ç»“æœï¼ˆå€¼ï¼‰
const memoizedValue = useMemo(() => computeExpensiveValue(a, b), [a, b]);

// useCallbackï¼šç¼“å­˜å‡½æ•°å¼•ç”¨
const memoizedCallback = useCallback(() => {
  doSomething(a, b);
}, [a, b]);

// ç­‰ä»·å…³ç³»
useCallback(fn, deps) === useMemo(() => fn, deps)
```

| ç‰¹æ€§ | useMemo | useCallback |
|-----|---------|-------------|
| è¿”å›å€¼ | ç¼“å­˜çš„**å€¼**ï¼ˆå¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼‰ | ç¼“å­˜çš„**å‡½æ•°** |
| ç”¨é€” | é¿å…æ¯æ¬¡æ¸²æŸ“è¿›è¡Œé«˜å¼€é”€è®¡ç®— | é¿å…å­ç»„ä»¶å› å‡½æ•°å¼•ç”¨å˜åŒ–è€Œé‡æ¸²æŸ“ |
| ç±»æ¯” | ç¼“å­˜è®¡ç®—ç»“æœ | shouldComponentUpdate |

### useReducer vs useState

```javascript
// useStateï¼šç®€å•çŠ¶æ€
const [count, setCount] = useState(0);

// useReducerï¼šå¤æ‚çŠ¶æ€
const [state, dispatch] = useReducer(reducer, initialState);

function reducer(state, action) {
  switch (action.type) {
    case 'increment': return { count: state.count + 1 };
    case 'decrement': return { count: state.count - 1 };
    default: return state;
  }
}
```

| åœºæ™¯ | æ¨è |
|-----|------|
| ç®€å•çŠ¶æ€ï¼ˆå•ä¸€å€¼ï¼‰ | useState |
| å¤æ‚çŠ¶æ€ï¼ˆå¤šä¸ªå­å€¼ï¼‰ | useReducer |
| ä¸‹ä¸€ä¸ª state ä¾èµ–ä¸Šä¸€ä¸ª state | useReducer |
| éœ€è¦å‘æ·±å±‚å­ç»„ä»¶ä¼ é€’æ›´æ–°é€»è¾‘ | useReducer + dispatch |

### useLayoutEffect vs useEffect

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ‰§è¡Œæ—¶æœºå¯¹æ¯”                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  æ¸²æŸ“ â†’ DOM æ›´æ–° â†’ useLayoutEffect â†’ æµè§ˆå™¨ç»‘åˆ¶ â†’ useEffect  â”‚
â”‚                    ï¼ˆåŒæ­¥ï¼Œé˜»å¡ç»˜åˆ¶ï¼‰    ï¼ˆå¼‚æ­¥ï¼Œä¸é˜»å¡ï¼‰     â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| ç‰¹æ€§ | useLayoutEffect | useEffect |
|-----|-----------------|-----------|
| æ‰§è¡Œæ—¶æœº | DOM æ›´æ–°åï¼Œç»˜åˆ¶å‰ | æµè§ˆå™¨ç»˜åˆ¶å |
| æ‰§è¡Œæ–¹å¼ | åŒæ­¥ï¼Œé˜»å¡ç»˜åˆ¶ | å¼‚æ­¥ï¼Œä¸é˜»å¡ |
| é€‚ç”¨åœºæ™¯ | è¯»å–/ä¿®æ”¹ DOM å¸ƒå±€ï¼Œé˜²é—ªçƒ | å¤§å¤šæ•°å‰¯ä½œç”¨ |
| æ€§èƒ½å½±å“ | å¯èƒ½å¯¼è‡´ç»˜åˆ¶å»¶è¿Ÿ | æ—  |
| SSR | âš ï¸ ä¼šè§¦å‘è­¦å‘Š | âœ… æ¨è |

### useRef vs React.createRef

```javascript
// useRefï¼ˆå‡½æ•°ç»„ä»¶ï¼‰
const refContainer = useRef(initialValue);
// è¿”å› { current: initialValue }
// æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¿æŒä¸å˜

// createRefï¼ˆclass ç»„ä»¶ï¼‰
this.myRef = React.createRef();
// é€šè¿‡ ref å±æ€§é™„åŠ åˆ°å…ƒç´ 
// .current æŒ‡å‘ DOM èŠ‚ç‚¹æˆ–ç»„ä»¶å®ä¾‹
```

| ç‰¹æ€§ | useRef | createRef |
|-----|--------|-----------|
| ä½¿ç”¨åœºæ™¯ | å‡½æ•°ç»„ä»¶ | class ç»„ä»¶ |
| ç”¨é€” | å¤šæ ·ï¼ˆDOMã€ä»»æ„å¯å˜å€¼ï¼‰ | å•ä¸€ï¼ˆDOM å¼•ç”¨ï¼‰ |
| ç”Ÿå‘½å‘¨æœŸ | æ¯æ¬¡æ¸²æŸ“è¿”å›åŒä¸€ä¸ªå¯¹è±¡ | æ¯æ¬¡è°ƒç”¨åˆ›å»ºæ–°å¯¹è±¡ |
| å¯å­˜å‚¨å†…å®¹ | ä»»ä½•å¯å˜å€¼ | DOM/ç»„ä»¶å®ä¾‹å¼•ç”¨ |

---

## äº”ã€è‡ªå®šä¹‰ Hook

### å®šä¹‰

è‡ªå®šä¹‰ Hook æ˜¯å°†ç»„ä»¶é€»è¾‘æå–åˆ°**å¯é‡ç”¨å‡½æ•°**ä¸­çš„æ–¹å¼ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è‡ªå®šä¹‰ Hook ç‰¹ç‚¹                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â€¢ å‘½åä»¥ "use" å¼€å¤´ï¼ˆä¾¿äº React æ£€æŸ¥è§„åˆ™ï¼‰                  â”‚
â”‚  â€¢ å¯ä»¥è°ƒç”¨å…¶ä»– Hook                                         â”‚
â”‚  â€¢ å‚æ•°å’Œè¿”å›å€¼å¯è‡ªå®šä¹‰                                      â”‚
â”‚  â€¢ æ¯æ¬¡è°ƒç”¨è·å–ç‹¬ç«‹çš„ stateï¼ˆä¸å…±äº«ï¼‰                        â”‚
â”‚  â€¢ è§£å†³äº†ä¹‹å‰éœ€è¦ HOC / render props æ‰èƒ½å¤ç”¨é€»è¾‘çš„é—®é¢˜       â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¸¸è§è‡ªå®šä¹‰ Hook ç¤ºä¾‹

```javascript
// 1. useWindowSize - ç›‘å¬çª—å£å°ºå¯¸
function useWindowSize() {
  const [size, setSize] = useState({
    width: window.innerWidth,
    height: window.innerHeight
  });

  useEffect(() => {
    const handleResize = () => {
      setSize({ width: window.innerWidth, height: window.innerHeight });
    };
    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  return size;
}

// 2. useLocalStorage - æœ¬åœ°å­˜å‚¨åŒæ­¥
function useLocalStorage(key, initialValue) {
  const [storedValue, setStoredValue] = useState(() => {
    try {
      const item = window.localStorage.getItem(key);
      return item ? JSON.parse(item) : initialValue;
    } catch (error) {
      return initialValue;
    }
  });

  const setValue = value => {
    setStoredValue(value);
    window.localStorage.setItem(key, JSON.stringify(value));
  };

  return [storedValue, setValue];
}
```

---

## å…­ã€useState çš„åŒæ­¥ä¸å¼‚æ­¥

### æ›´æ–°å‡½æ•°æ˜¯å¼‚æ­¥çš„

```javascript
const [count, setCount] = useState(0);

const handleClick = () => {
  setCount(count + 1);
  console.log(count); // ä»ç„¶æ˜¯ 0ï¼Œä¸æ˜¯ 1
};
```

### è·å–æ›´æ–°åçŠ¶æ€çš„ä¸¤ç§æ–¹å¼

```javascript
// æ–¹å¼1ï¼šå‡½æ•°å¼æ›´æ–°ï¼ˆè·å–ä¸Šä¸€ä¸ª stateï¼‰
setCount(prevCount => prevCount + 1);

// æ–¹å¼2ï¼šuseEffect ç›‘å¬å˜åŒ–
useEffect(() => {
  console.log('count updated:', count);
}, [count]);
```

---

## ä¸ƒã€æ˜¯å¦è¦ç”¨ Hook é‡å†™æ‰€æœ‰ Classï¼Ÿ

**ç­”æ¡ˆï¼šä¸éœ€è¦ã€‚**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è¿ç§»å»ºè®®                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  âœ… æ–°ç»„ä»¶å»ºè®®ä½¿ç”¨ Hook                                      â”‚
â”‚                                                             â”‚
â”‚  âš ï¸ Hook æš‚ä¸èƒ½è¦†ç›– class çš„æ‰€æœ‰åœºæ™¯ï¼š                       â”‚
â”‚     â€¢ getSnapshotBeforeUpdate                               â”‚
â”‚     â€¢ getDerivedStateFromError                              â”‚
â”‚     â€¢ componentDidCatch                                     â”‚
â”‚                                                             â”‚
â”‚  âŒ ä¸æ¨èç”¨ Hook é‡å†™å·²æœ‰çš„ class                           â”‚
â”‚     ï¼ˆé™¤éæœ¬æ¥å°±æ‰“ç®—é‡æ„ï¼Œå¦‚ä¿®å¤ bugï¼‰                       â”‚
â”‚                                                             â”‚
â”‚  React æ²¡æœ‰è®¡åˆ’ç§»é™¤ class                                    â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…«ã€é¢è¯•é—®ç­”é€ŸæŸ¥

| é—®é¢˜ | ç­”æ¡ˆ |
|-----|------|
| Hook æ˜¯ä»€ä¹ˆï¼Ÿ | React 16.8 æ–°ç‰¹æ€§ï¼Œè®©å‡½æ•°ç»„ä»¶èƒ½ä½¿ç”¨ state å’Œç”Ÿå‘½å‘¨æœŸ |
| Hook è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ | é€»è¾‘åˆ†æ•£ã€å¤ç”¨å›°éš¾ã€this ç»‘å®šã€ä»£ç ä¼˜åŒ– |
| Hook ä½¿ç”¨è§„åˆ™ï¼Ÿ | 1) åªåœ¨æœ€é¡¶å±‚è°ƒç”¨ 2) åªåœ¨ React å‡½æ•°ä¸­è°ƒç”¨ |
| useEffect å’Œ useLayoutEffect åŒºåˆ«ï¼Ÿ | useEffect å¼‚æ­¥ä¸é˜»å¡ç»˜åˆ¶ï¼ŒuseLayoutEffect åŒæ­¥é˜»å¡ç»˜åˆ¶ |
| useMemo å’Œ useCallback åŒºåˆ«ï¼Ÿ | useMemo è¿”å›å€¼ï¼ŒuseCallback è¿”å›å‡½æ•° |
| useState æ›´æ–°æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Ÿ | å¼‚æ­¥çš„ï¼Œå¯ç”¨å‡½æ•°å¼æ›´æ–°æˆ– useEffect è·å–æ–°å€¼ |
| è‡ªå®šä¹‰ Hook å‘½åè§„åˆ™ï¼Ÿ | å¿…é¡»ä»¥ "use" å¼€å¤´ |

---

## ä¹ã€ç»å…¸é¢è¯•ä»£ç 

### é¢è¯•é¢˜ 1ï¼šå®ç° useMount å’Œ useUnmount ğŸ”¥

```javascript
// ä»…åœ¨æŒ‚è½½æ—¶æ‰§è¡Œ
function useMount(fn) {
  useEffect(() => {
    fn();
  }, []); // ç©ºä¾èµ–ï¼Œåªæ‰§è¡Œä¸€æ¬¡
}

// ä»…åœ¨å¸è½½æ—¶æ‰§è¡Œ
function useUnmount(fn) {
  const fnRef = useRef(fn);
  fnRef.current = fn; // ä¿æŒæœ€æ–°å¼•ç”¨

  useEffect(() => {
    return () => fnRef.current();
  }, []);
}

// ä½¿ç”¨
function Component() {
  useMount(() => console.log('mounted'));
  useUnmount(() => console.log('unmounted'));
  return <div>Hello</div>;
}
```

### é¢è¯•é¢˜ 2ï¼šå®ç° usePrevious ğŸ”¥

```javascript
function usePrevious(value) {
  const ref = useRef();
  
  useEffect(() => {
    ref.current = value;
  }, [value]);
  
  return ref.current; // è¿”å›ä¸Šä¸€æ¬¡çš„å€¼
}

// ä½¿ç”¨
function Counter() {
  const [count, setCount] = useState(0);
  const prevCount = usePrevious(count);
  
  return (
    <div>
      <p>Now: {count}, Before: {prevCount}</p>
      <button onClick={() => setCount(count + 1)}>+1</button>
    </div>
  );
}
```

### é¢è¯•é¢˜ 3ï¼šå®ç° useDebounce ğŸ”¥

```javascript
function useDebounce(value, delay) {
  const [debouncedValue, setDebouncedValue] = useState(value);

  useEffect(() => {
    const timer = setTimeout(() => {
      setDebouncedValue(value);
    }, delay);

    return () => clearTimeout(timer);
  }, [value, delay]);

  return debouncedValue;
}

// ä½¿ç”¨
function SearchInput() {
  const [input, setInput] = useState('');
  const debouncedInput = useDebounce(input, 500);

  useEffect(() => {
    if (debouncedInput) {
      // å‘èµ·æœç´¢
      searchAPI(debouncedInput);
    }
  }, [debouncedInput]);

  return <input value={input} onChange={e => setInput(e.target.value)} />;
}
```

### é¢è¯•é¢˜ 4ï¼šå®ç° useInterval â­

```javascript
function useInterval(callback, delay) {
  const savedCallback = useRef();

  // ä¿å­˜æœ€æ–°çš„ callback
  useEffect(() => {
    savedCallback.current = callback;
  }, [callback]);

  // è®¾ç½®å®šæ—¶å™¨
  useEffect(() => {
    if (delay !== null) {
      const id = setInterval(() => savedCallback.current(), delay);
      return () => clearInterval(id);
    }
  }, [delay]);
}

// ä½¿ç”¨
function Timer() {
  const [count, setCount] = useState(0);

  useInterval(() => {
    setCount(count + 1);
  }, 1000);

  return <div>Count: {count}</div>;
}
```

### é¢è¯•é¢˜ 5ï¼šå®ç° useFetch â­

```javascript
function useFetch(url) {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    const controller = new AbortController();

    setLoading(true);
    setError(null);

    fetch(url, { signal: controller.signal })
      .then(res => res.json())
      .then(data => {
        setData(data);
        setLoading(false);
      })
      .catch(err => {
        if (err.name !== 'AbortError') {
          setError(err);
          setLoading(false);
        }
      });

    return () => controller.abort();
  }, [url]);

  return { data, loading, error };
}

// ä½¿ç”¨
function UserProfile({ userId }) {
  const { data, loading, error } = useFetch(`/api/user/${userId}`);

  if (loading) return <div>Loading...</div>;
  if (error) return <div>Error: {error.message}</div>;
  return <div>{data.name}</div>;
}
```

### é¢è¯•é¢˜ 6ï¼šuseReducer å®ç° Todo â­

```javascript
const initialState = { todos: [] };

function reducer(state, action) {
  switch (action.type) {
    case 'ADD':
      return { todos: [...state.todos, { id: Date.now(), text: action.text, done: false }] };
    case 'TOGGLE':
      return {
        todos: state.todos.map(todo =>
          todo.id === action.id ? { ...todo, done: !todo.done } : todo
        )
      };
    case 'DELETE':
      return { todos: state.todos.filter(todo => todo.id !== action.id) };
    default:
      return state;
  }
}

function TodoApp() {
  const [state, dispatch] = useReducer(reducer, initialState);
  const [input, setInput] = useState('');

  const handleAdd = () => {
    if (input.trim()) {
      dispatch({ type: 'ADD', text: input });
      setInput('');
    }
  };

  return (
    <div>
      <input value={input} onChange={e => setInput(e.target.value)} />
      <button onClick={handleAdd}>Add</button>
      <ul>
        {state.todos.map(todo => (
          <li key={todo.id} style={{ textDecoration: todo.done ? 'line-through' : 'none' }}>
            <span onClick={() => dispatch({ type: 'TOGGLE', id: todo.id })}>{todo.text}</span>
            <button onClick={() => dispatch({ type: 'DELETE', id: todo.id })}>Ã—</button>
          </li>
        ))}
      </ul>
    </div>
  );
}
```

---

## åã€æ ¸å¿ƒè¦ç‚¹æ€»ç»“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    React Hooks è¦ç‚¹                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  useState      â†’  å‡½æ•°ç»„ä»¶ä¸­æ·»åŠ  stateï¼Œè¿”å› [state, setState] â”‚
â”‚  useEffect     â†’  å‰¯ä½œç”¨æ“ä½œï¼Œå¼‚æ­¥æ‰§è¡Œï¼Œè¿”å›æ¸…ç†å‡½æ•°           â”‚
â”‚  useLayoutEffect â†’ åŒæ­¥å‰¯ä½œç”¨ï¼ŒDOM åç»˜åˆ¶å‰ï¼Œé˜²é—ªçƒ            â”‚
â”‚  useMemo       â†’  ç¼“å­˜è®¡ç®—ç»“æœï¼ˆå€¼ï¼‰                           â”‚
â”‚  useCallback   â†’  ç¼“å­˜å‡½æ•°å¼•ç”¨                                 â”‚
â”‚  useReducer    â†’  å¤æ‚çŠ¶æ€ç®¡ç†ï¼Œè¿”å› [state, dispatch]         â”‚
â”‚  useRef        â†’  å¯å˜å¼•ç”¨ï¼Œæ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¿æŒä¸å˜               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è§„åˆ™ï¼š1) åªåœ¨æœ€é¡¶å±‚è°ƒç”¨  2) åªåœ¨ React å‡½æ•°ä¸­è°ƒç”¨             â”‚
â”‚  è‡ªå®šä¹‰ Hookï¼šä»¥ "use" å¼€å¤´ï¼Œå¤ç”¨çŠ¶æ€é€»è¾‘                      â”‚
â”‚  setStateï¼šå¼‚æ­¥æ›´æ–°ï¼Œç”¨å‡½æ•°å¼æ›´æ–°è·å–ä¸Šä¸€ä¸ª state              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**ä¸€å¥è¯æ€»ç»“**ï¼šHooks è®©å‡½æ•°ç»„ä»¶æ‹¥æœ‰äº† Class çš„èƒ½åŠ›ï¼Œé€šè¿‡"çŠ¶æ€é’©å­"å’Œ"å‰¯ä½œç”¨é’©å­"å®ç°é€»è¾‘å†…èšä¸å¤ç”¨ï¼Œæ˜¯ React æ‹¥æŠ±å‡½æ•°å¼ç¼–ç¨‹çš„å…³é”®ä¸€æ­¥ã€‚