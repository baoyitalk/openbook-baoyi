# React æµ‹è¯• (Jest) - ç¬¬ä¸€æ€§åŸç†æ·±åº¦æ‹†è§£

## ä¸€ã€ç¬¬ä¸€æ€§åŸç†ï¼šä¸ºä»€ä¹ˆéœ€è¦å‰ç«¯æµ‹è¯•ï¼Ÿ

### æœ¬è´¨æ€è€ƒ

è½¯ä»¶çš„æ ¸å¿ƒä»·å€¼æ˜¯**å¯é æ€§**ã€‚å‰ç«¯æµ‹è¯•çš„ç›®çš„æ˜¯ï¼š
1. **éªŒè¯åŠŸèƒ½æ­£ç¡®æ€§** â€” ç¡®ä¿ä»£ç æŒ‰é¢„æœŸå·¥ä½œ
2. **é˜²æ­¢å›å½’** â€” ä¿®æ”¹ä»£ç åä¸ç ´åå·²æœ‰åŠŸèƒ½
3. **æé«˜ä¿¡å¿ƒ** â€” é‡æ„å’Œå‘å¸ƒæ—¶æ›´æœ‰æŠŠæ¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯æµ‹è¯•é‡‘å­—å¡”                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚                        /\                                   â”‚
â”‚                       /  \       E2E æµ‹è¯•                   â”‚
â”‚                      /    \      (Cypress/Puppeteer)        â”‚
â”‚                     /â”€â”€â”€â”€â”€â”€\                                â”‚
â”‚                    /        \    é›†æˆæµ‹è¯•                    â”‚
â”‚                   /          \   (React Testing Library)    â”‚
â”‚                  /â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\                             â”‚
â”‚                 /              \  å•å…ƒæµ‹è¯•                   â”‚
â”‚                /________________\ (Jest)                    â”‚
â”‚                                                             â”‚
â”‚  è¶Šåº•å±‚ï¼šé€Ÿåº¦å¿«ã€æˆæœ¬ä½ã€è¦†ç›–ç»†èŠ‚                             â”‚
â”‚  è¶Šé¡¶å±‚ï¼šé€Ÿåº¦æ…¢ã€æˆæœ¬é«˜ã€è¦†ç›–å…¨å±€                             â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€ä»€ä¹ˆæ˜¯ Jestï¼Ÿ

### å®šä¹‰

Jest æ˜¯ä¸€æ¬¾ JavaScript **æµ‹è¯•è¿è¡Œå™¨**ï¼Œç”± Facebook å¼€å‘ç»´æŠ¤ã€‚

### æ ¸å¿ƒç‰¹ç‚¹

| ç‰¹ç‚¹ | è¯´æ˜ |
|-----|------|
| **é›¶é…ç½®** | å¼€ç®±å³ç”¨ï¼Œæ— éœ€å¤æ‚é…ç½® |
| **å¿«ç…§æµ‹è¯•** | è‡ªåŠ¨è®°å½•ç»„ä»¶è¾“å‡ºï¼Œæ£€æµ‹æ„å¤–å˜åŒ– |
| **å¹¶è¡Œæ‰§è¡Œ** | å¤šè¿›ç¨‹å¹¶è¡Œè¿è¡Œæµ‹è¯•ï¼Œé€Ÿåº¦å¿« |
| **è¿­ä»£å¿«** | åªè¿è¡Œä¸ä¿®æ”¹ç›¸å…³çš„æµ‹è¯• |
| **ç”Ÿæ€ä¸°å¯Œ** | Mock Functionsã€Timer Mocks ç­‰ |

### Jest çš„èƒ½åŠ›

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Jest æ ¸å¿ƒèƒ½åŠ›                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  æ¨¡æ‹Ÿç¯å¢ƒ                                                    â”‚
â”‚  â”œâ”€â”€ jsdomï¼šæ¨¡æ‹Ÿ DOM ç¯å¢ƒï¼ˆNode.js ä¸­ï¼‰                      â”‚
â”‚  â””â”€â”€ Puppeteerï¼šçœŸå®æµè§ˆå™¨ç¯å¢ƒ                               â”‚
â”‚                                                             â”‚
â”‚  Mock èƒ½åŠ›                                                   â”‚
â”‚  â”œâ”€â”€ jest.mock()ï¼šæ¨¡æ‹Ÿæ¨¡å—                                  â”‚
â”‚  â”œâ”€â”€ jest.spyOn()ï¼šç›‘è§†å‡½æ•°è°ƒç”¨                             â”‚
â”‚  â””â”€â”€ jest.fn()ï¼šåˆ›å»º mock å‡½æ•°                              â”‚
â”‚                                                             â”‚
â”‚  è®¡æ—¶å™¨æ§åˆ¶                                                  â”‚
â”‚  â”œâ”€â”€ jest.useFakeTimers()ï¼šæ¨¡æ‹Ÿè®¡æ—¶å™¨                       â”‚
â”‚  â””â”€â”€ jest.runAllTimers()ï¼šå¿«è¿›æ‰§è¡Œ                          â”‚
â”‚                                                             â”‚
â”‚  æ–­è¨€ & è¦†ç›–ç‡                                               â”‚
â”‚  â”œâ”€â”€ expect()ï¼šä¸°å¯Œçš„æ–­è¨€ API                               â”‚
â”‚  â””â”€â”€ --coverageï¼šæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š                              â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€å¦‚ä½•æ¨¡æ‹Ÿæ•°æ®è·å–ï¼Ÿ

### ä¸ºä»€ä¹ˆè¦æ¨¡æ‹Ÿï¼Ÿ

- é˜²æ­¢åç«¯ä¸å¯ç”¨å¯¼è‡´æµ‹è¯•ä¸ç¨³å®š
- åŠ å¿«æµ‹è¯•è¿è¡Œé€Ÿåº¦
- æ§åˆ¶è¿”å›æ•°æ®ï¼Œæµ‹è¯•è¾¹ç•Œæƒ…å†µ

### æ–¹å¼ä¸€ï¼šjest.mock()

```javascript
import axios from 'axios';

// æ¨¡æ‹Ÿæ•´ä¸ª axios æ¨¡å—
jest.mock('axios');

test('Test axios', async () => {
  // è®¾ç½® mock è¿”å›å€¼
  axios.get.mockResolvedValueOnce('data');
  
  const data = await axios.get('/api');
  expect(data).toBe('data');
});
```

### æ–¹å¼äºŒï¼šjest.spyOn()

```javascript
test('Test fetch', async () => {
  // ç›‘è§† global.fetch å¹¶æ¨¡æ‹Ÿå®ç°
  jest.spyOn(global, 'fetch').mockImplementation(() =>
    Promise.resolve({
      json: () => Promise.resolve('data')
    })
  );

  const response = await fetch('/api');
  const data = await response.json();
  expect(data).toBe('data');
});
```

### ä¸¤è€…åŒºåˆ«

| æ–¹å¼ | ç”¨é€” | ç‰¹ç‚¹ |
|-----|------|------|
| `jest.mock()` | æ¨¡æ‹Ÿæ•´ä¸ªæ¨¡å— | è‡ªåŠ¨ mock æ‰€æœ‰å¯¼å‡º |
| `jest.spyOn()` | ç›‘è§†ç‰¹å®šæ–¹æ³• | å¯ä¿ç•™åŸå®ç°ï¼Œåªç›‘è§†è°ƒç”¨ |

---

## å››ã€å¦‚ä½•æ¨¡æ‹Ÿç»„ä»¶ï¼Ÿ

ä½¿ç”¨ `jest.mock()` çš„ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥å·¥å‚å‡½æ•°ï¼š

```javascript
// æ¨¡æ‹Ÿå­ç»„ä»¶ï¼Œé¿å…æµ‹è¯•æ—¶æ¸²æŸ“å¤æ‚å­ç»„ä»¶
jest.mock('./common/MyComponent', () => {
  // è¿”å›ä¸€ä¸ªç®€åŒ–ç‰ˆçš„å‡½æ•°ç»„ä»¶
  return (props) => <>{props.text}</>;
});

// æµ‹è¯•æ—¶ï¼ŒMyComponent ä¼šè¢«æ›¿æ¢ä¸ºç®€å•çš„æ–‡æœ¬æ¸²æŸ“
```

### ä½¿ç”¨åœºæ™¯

- å­ç»„ä»¶å¤æ‚ï¼Œä¸æƒ³åœ¨çˆ¶ç»„ä»¶æµ‹è¯•ä¸­æ¸²æŸ“
- å­ç»„ä»¶æœ‰å‰¯ä½œç”¨ï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ï¼‰
- éš”ç¦»æµ‹è¯•ï¼Œä¸“æ³¨äºå½“å‰ç»„ä»¶é€»è¾‘

---

## äº”ã€å¦‚ä½•æ¨¡æ‹Ÿè®¡æ—¶å™¨ï¼Ÿ

### API æ€»è§ˆ

| API | ä½œç”¨ |
|-----|------|
| `jest.useFakeTimers()` | å¼€å¯æ¨¡æ‹Ÿè®¡æ—¶å™¨ |
| `jest.runAllTimers()` | æ‰§è¡Œæ‰€æœ‰è®¡æ—¶å™¨ |
| `jest.runOnlyPendingTimers()` | åªæ‰§è¡Œå½“å‰æŒ‚èµ·çš„è®¡æ—¶å™¨ |
| `jest.advanceTimersByTime(ms)` | å¿«è¿›æŒ‡å®šæ¯«ç§’æ•° |
| `jest.useRealTimers()` | æ¢å¤çœŸå®è®¡æ—¶å™¨ |

### ä»£ç ç¤ºä¾‹

```javascript
// è¢«æµ‹å‡½æ•°
function delayedGreeting(callback) {
  setTimeout(() => {
    callback('Hello');
  }, 1000);
}

// æµ‹è¯•
test('calls callback after 1 second', () => {
  jest.useFakeTimers();
  const callback = jest.fn();

  delayedGreeting(callback);

  // æ­¤æ—¶ callback è¿˜æ²¡è¢«è°ƒç”¨
  expect(callback).not.toHaveBeenCalled();

  // å¿«è¿› 1000ms
  jest.advanceTimersByTime(1000);

  // ç°åœ¨ callback è¢«è°ƒç”¨äº†
  expect(callback).toHaveBeenCalledWith('Hello');
});
```

### runAllTimers vs runOnlyPendingTimers

```javascript
// å¦‚æœè®¡æ—¶å™¨ä¼šé€’å½’åˆ›å»ºæ–°è®¡æ—¶å™¨
function recursiveTimer() {
  setTimeout(() => {
    recursiveTimer(); // é€’å½’è°ƒç”¨
  }, 100);
}

// âŒ runAllTimers ä¼šæ­»å¾ªç¯
jest.runAllTimers();

// âœ… runOnlyPendingTimers åªæ‰§è¡Œå½“å‰æŒ‚èµ·çš„ï¼Œé¿å…æ­»å¾ªç¯
jest.runOnlyPendingTimers();
```

---

## å…­ã€å¦‚ä½•æ¨¡æ‹Ÿæµ…å±‚æ¸²æŸ“ï¼Ÿ

### ä»€ä¹ˆæ˜¯æµ…å±‚æ¸²æŸ“ï¼Ÿ

**åªæ¸²æŸ“çˆ¶ç»„ä»¶ï¼Œä¸æ¸²æŸ“å­ç»„ä»¶**ï¼Œå¯ä»¥åªæµ‹è¯•ç»„ä»¶çš„"ç¬¬ä¸€å±‚"ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æµ…å±‚æ¸²æŸ“ vs å®Œæ•´æ¸²æŸ“                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  å®Œæ•´æ¸²æŸ“ï¼š                æµ…å±‚æ¸²æŸ“ï¼š                        â”‚
â”‚  <Parent>                  <Parent>                         â”‚
â”‚    <Child>        vs         <Child />  â† ä¸å±•å¼€            â”‚
â”‚      <GrandChild />        </Parent>                        â”‚
â”‚    </Child>                                                 â”‚
â”‚  </Parent>                                                  â”‚
â”‚                                                             â”‚
â”‚  ä¼˜ç‚¹ï¼š                                                      â”‚
â”‚  â€¢ æ–¹ä¾¿å¯¹ç»„ä»¶ render è¿”å›å€¼æ–­è¨€                              â”‚
â”‚  â€¢ ä¸å¿…æ‹…å¿ƒå­ç»„ä»¶è¡Œä¸º                                        â”‚
â”‚  â€¢ æµ…å±‚æ¸²æŸ“ä¸ä¾èµ– DOM                                        â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ–¹å¼ä¸€ï¼šEnzyme shallow()

```javascript
import { shallow } from 'enzyme';
import MyComponent from './MyComponent';

describe('shallow render', () => {
  it('renders correctly', () => {
    const wrapper = shallow(<MyComponent />);
    expect(wrapper.contains(<div></div>)).toEqual(true);
  });
});
```

### æ–¹å¼äºŒï¼šreact-test-renderer/shallow

```javascript
import ShallowRenderer from 'react-test-renderer/shallow';

const renderer = new ShallowRenderer();
renderer.render(<MyComponent />);
const result = renderer.getRenderOutput();

expect(result.props.children).toEqual([<div></div>]);
```

---

## ä¸ƒã€å¦‚ä½•å°†ç»„ä»¶æ¸²æŸ“æˆ JS å¯¹è±¡ï¼Ÿï¼ˆå¿«ç…§æµ‹è¯•ï¼‰

### react-test-renderer + Jest å¿«ç…§

```javascript
import renderer from 'react-test-renderer';

test('Link renders correctly', () => {
  const tree = renderer.create(
    <Link page="http://www.facebook.com">Facebook</Link>
  ).toJSON();
  
  // å¿«ç…§åŒ¹é…
  expect(tree).toMatchSnapshot();
});
```

### å¿«ç…§æ–‡ä»¶ç¤ºä¾‹

```javascript
// __snapshots__/Link.test.js.snap
exports[`Link renders correctly 1`] = `
<a
  className="normal"
  href="http://www.facebook.com"
  onMouseEnter={[Function bound _onMouseEnter]}
  onMouseLeave={[Function bound _onMouseLeave]}
>
  Facebook
</a>
`;
```

### å¿«ç…§æµ‹è¯•æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¿«ç…§æµ‹è¯•æµç¨‹                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  é¦–æ¬¡è¿è¡Œæµ‹è¯•                                                â”‚
â”‚       â†“                                                     â”‚
â”‚  Jest åˆ›å»ºå¿«ç…§æ–‡ä»¶ï¼ˆ.snapï¼‰                                  â”‚
â”‚       â†“                                                     â”‚
â”‚  åç»­è¿è¡Œæµ‹è¯•                                                â”‚
â”‚       â†“                                                     â”‚
â”‚  æ¸²æŸ“è¾“å‡º vs å¿«ç…§æ–‡ä»¶                                        â”‚
â”‚       â†“                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚  â”‚  åŒ¹é…   â”‚    â”‚ ä¸åŒ¹é…  â”‚                                 â”‚
â”‚  â”‚  âœ… é€šè¿‡ â”‚    â”‚  â†“     â”‚                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ æ›´æ–°å¿«ç…§ jest -u                          â”‚
â”‚                 â”‚ æˆ– æµ‹è¯•å¤±è´¥                                â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…«ã€å¦‚ä½•æ¨¡æ‹Ÿ DOM ç¯å¢ƒï¼Ÿ

### jsdomï¼ˆæ¨èï¼‰

æµ‹è¯•é€šå¸¸åœ¨ Node.js ä¸­è¿è¡Œï¼Œæ— æ³•è®¿é—®çœŸå®æµè§ˆå™¨ã€‚**jsdom** æ˜¯ä¸€ä¸ªè½»é‡çº§æµè§ˆå™¨å®ç°ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    jsdom ç‰¹ç‚¹                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  âœ… è¡Œä¸ºç±»ä¼¼å¸¸è§„æµè§ˆå™¨                                       â”‚
â”‚  âœ… è¿è¡Œæ•ˆç‡æ¯”å¯åŠ¨çœŸå®æµè§ˆå™¨é«˜                               â”‚
â”‚  âœ… ä¸æµ‹è¯•è¿è¡Œåœ¨åŒä¸€è¿›ç¨‹ï¼Œå¯æ£€æŸ¥å’Œæ–­è¨€ DOM                    â”‚
â”‚  âœ… å¯æ¨¡æ‹Ÿç”¨æˆ·äº¤äº’ï¼Œåœ¨ DOM èŠ‚ç‚¹ä¸Šæ´¾å‘äº‹ä»¶                     â”‚
â”‚                                                             â”‚
â”‚  âŒ ä¸å…·å¤‡å¸ƒå±€å’Œå¯¼èˆªåŠŸèƒ½                                     â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Jest + jsdom + act()

```javascript
import { render, fireEvent } from '@testing-library/react';

test('button click', () => {
  const { getByText } = render(<Button />);
  
  // æ¨¡æ‹Ÿç‚¹å‡»
  fireEvent.click(getByText('Click me'));
  
  // æ–­è¨€ç»“æœ
  expect(getByText('Clicked!')).toBeInTheDocument();
});
```

### çœŸå®æµè§ˆå™¨æµ‹è¯•

å½“éœ€è¦æµ‹è¯•å¸ƒå±€ã€å¯¼èˆªç­‰åŸç”Ÿæµè§ˆå™¨è¡Œä¸ºæ—¶ï¼š

| å·¥å…· | ç‰¹ç‚¹ |
|-----|------|
| **Cypress** | E2E æµ‹è¯•ï¼ŒAPI å‹å¥½ |
| **Puppeteer** | Chrome headlessï¼ŒGoogle å‡ºå“ |
| **WebDriver** | æ ‡å‡†åŒ–åè®®ï¼Œæ”¯æŒå¤šæµè§ˆå™¨ |

---

## ä¹ã€å¦‚ä½•è·å¾—æµ‹è¯•ä»£ç è¦†ç›–ç‡ï¼Ÿ

### Istanbul + Jest

```bash
# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
jest --coverage
```

### è¦†ç›–ç‡æŒ‡æ ‡

| æŒ‡æ ‡ | è¯´æ˜ |
|-----|------|
| **Statements** | è¯­å¥è¦†ç›–ç‡ |
| **Branches** | åˆ†æ”¯è¦†ç›–ç‡ï¼ˆif/elseï¼‰ |
| **Functions** | å‡½æ•°è¦†ç›–ç‡ |
| **Lines** | è¡Œè¦†ç›–ç‡ |

### è¦†ç›–ç‡æŠ¥å‘Šç¤ºä¾‹

```
----------|---------|----------|---------|---------|
File      | % Stmts | % Branch | % Funcs | % Lines |
----------|---------|----------|---------|---------|
All files |   85.71 |    66.67 |     100 |   85.71 |
 Button.js|   85.71 |    66.67 |     100 |   85.71 |
----------|---------|----------|---------|---------|
```

---

## åã€å¦‚ä½•æµ‹è¯• React Routerï¼Ÿ

### æ ¸å¿ƒæ€è·¯

1. ä½¿ç”¨ `createMemoryHistory()` åˆ›å»ºå¯¼èˆªå†å²
2. æ¨¡æ‹Ÿç‚¹å‡»å¯¼èˆªæŒ‰é’®
3. ç­‰å¾…é¡µé¢ DOM åŠ è½½
4. åˆ¤æ–­é¡µé¢ç‹¬æœ‰å…ƒç´ æ˜¯å¦è¢«åŠ è½½

### å®Œæ•´ç¤ºä¾‹

```javascript
// App.jsx
import React from 'react';
import { Switch, Route, Link } from 'react-router-dom';

export const App = () => {
  return (
    <>
      <nav>
        <Link data-testid="home-link" to="/">Home</Link>
        <Link data-testid="about-link" to="/about">About</Link>
      </nav>
      <Switch>
        <Route path="/" exact component={Home} />
        <Route path="/about" component={About} />
      </Switch>
    </>
  );
};
```

```javascript
// App.test.js
import React from 'react';
import { Router } from 'react-router-dom';
import { render, fireEvent } from '@testing-library/react';
import { createMemoryHistory } from 'history';
import App from './App';
import '@testing-library/jest-dom/extend-expect';

// è¾…åŠ©å‡½æ•°ï¼šåŒ…è£… Router
const renderRouter = (Component) => {
  const history = createMemoryHistory();
  return render(<Router history={history}>{Component}</Router>);
};

describe('App Test', () => {
  it('render home page', () => {
    const { getByTestId } = renderRouter(<App />);
    expect(getByTestId('home')).toBeInTheDocument();
  });

  it('render about page', () => {
    const { container, getByTestId } = renderRouter(<App />);
    
    // æ¨¡æ‹Ÿç‚¹å‡» About é“¾æ¥
    fireEvent.click(getByTestId('about-link'));
    
    // æ–­è¨€é¡µé¢å†…å®¹
    expect(container.innerText).toHaveTextContent('About Company');
  });
});
```

---

## åä¸€ã€é¢è¯•é—®ç­”é€ŸæŸ¥

| é—®é¢˜ | ç­”æ¡ˆ |
|-----|------|
| Jest æ˜¯ä»€ä¹ˆï¼Ÿ | JavaScript æµ‹è¯•è¿è¡Œå™¨ï¼Œé›¶é…ç½®ã€æ”¯æŒå¿«ç…§ã€å¹¶è¡Œæ‰§è¡Œ |
| å¦‚ä½•æ¨¡æ‹Ÿ API è¯·æ±‚ï¼Ÿ | jest.mock() æ¨¡æ‹Ÿæ¨¡å— æˆ– jest.spyOn() ç›‘è§†æ–¹æ³• |
| å¦‚ä½•æ¨¡æ‹Ÿè®¡æ—¶å™¨ï¼Ÿ | jest.useFakeTimers() + runAllTimers/advanceTimersByTime |
| ä»€ä¹ˆæ˜¯æµ…å±‚æ¸²æŸ“ï¼Ÿ | åªæ¸²æŸ“å½“å‰ç»„ä»¶ï¼Œä¸æ¸²æŸ“å­ç»„ä»¶ |
| ä»€ä¹ˆæ˜¯å¿«ç…§æµ‹è¯•ï¼Ÿ | å°†ç»„ä»¶æ¸²æŸ“ä¸º JS å¯¹è±¡ï¼Œä¸ä¹‹å‰ä¿å­˜çš„å¿«ç…§æ¯”è¾ƒ |
| jsdom æ˜¯ä»€ä¹ˆï¼Ÿ | Node.js ä¸­çš„è½»é‡çº§æµè§ˆå™¨å®ç°ï¼Œæ¨¡æ‹Ÿ DOM ç¯å¢ƒ |
| å¦‚ä½•è·å–è¦†ç›–ç‡ï¼Ÿ | jest --coverage |

---

## åäºŒã€ç»å…¸é¢è¯•ä»£ç 

### é¢è¯•é¢˜ 1ï¼šæµ‹è¯•å¼‚æ­¥æ•°æ®è·å– ğŸ”¥

```javascript
// api.js
export const fetchUser = async (id) => {
  const response = await fetch(`/api/user/${id}`);
  return response.json();
};

// api.test.js
import { fetchUser } from './api';

test('fetchUser returns user data', async () => {
  // Mock fetch
  global.fetch = jest.fn(() =>
    Promise.resolve({
      json: () => Promise.resolve({ id: 1, name: 'John' })
    })
  );

  const user = await fetchUser(1);
  
  expect(fetch).toHaveBeenCalledWith('/api/user/1');
  expect(user).toEqual({ id: 1, name: 'John' });
});
```

### é¢è¯•é¢˜ 2ï¼šæµ‹è¯•ç»„ä»¶äº¤äº’ ğŸ”¥

```javascript
import { render, fireEvent, screen } from '@testing-library/react';

function Counter() {
  const [count, setCount] = useState(0);
  return (
    <div>
      <span data-testid="count">{count}</span>
      <button onClick={() => setCount(c => c + 1)}>+</button>
    </div>
  );
}

test('counter increments', () => {
  render(<Counter />);
  
  const countEl = screen.getByTestId('count');
  const button = screen.getByText('+');

  expect(countEl).toHaveTextContent('0');
  
  fireEvent.click(button);
  expect(countEl).toHaveTextContent('1');
  
  fireEvent.click(button);
  expect(countEl).toHaveTextContent('2');
});
```

### é¢è¯•é¢˜ 3ï¼šæµ‹è¯•å®šæ—¶å™¨ç»„ä»¶ ğŸ”¥

```javascript
function Countdown({ seconds, onComplete }) {
  const [remaining, setRemaining] = useState(seconds);

  useEffect(() => {
    if (remaining <= 0) {
      onComplete();
      return;
    }
    const timer = setTimeout(() => setRemaining(r => r - 1), 1000);
    return () => clearTimeout(timer);
  }, [remaining, onComplete]);

  return <div>{remaining}</div>;
}

test('countdown calls onComplete when finished', () => {
  jest.useFakeTimers();
  const onComplete = jest.fn();

  render(<Countdown seconds={3} onComplete={onComplete} />);

  // å¿«è¿› 3 ç§’
  jest.advanceTimersByTime(3000);

  expect(onComplete).toHaveBeenCalledTimes(1);
});
```

### é¢è¯•é¢˜ 4ï¼šå¿«ç…§æµ‹è¯• â­

```javascript
import renderer from 'react-test-renderer';

function Button({ children, onClick }) {
  return <button onClick={onClick}>{children}</button>;
}

test('Button snapshot', () => {
  const tree = renderer
    .create(<Button onClick={() => {}}>Click me</Button>)
    .toJSON();
  
  expect(tree).toMatchSnapshot();
});

// é¦–æ¬¡è¿è¡Œä¼šåˆ›å»ºå¿«ç…§æ–‡ä»¶
// åç»­è¿è¡Œä¼šä¸å¿«ç…§æ¯”è¾ƒ
// æ›´æ–°å¿«ç…§ï¼šjest -u
```

### é¢è¯•é¢˜ 5ï¼šMock æ¨¡å— â­

```javascript
// utils.js
export const formatDate = (date) => {
  return new Intl.DateTimeFormat('en-US').format(date);
};

// component.test.js
jest.mock('./utils', () => ({
  formatDate: jest.fn(() => '01/01/2024')
}));

import { formatDate } from './utils';
import { DateDisplay } from './DateDisplay';

test('displays formatted date', () => {
  render(<DateDisplay date={new Date()} />);
  
  expect(formatDate).toHaveBeenCalled();
  expect(screen.getByText('01/01/2024')).toBeInTheDocument();
});
```

---

## åä¸‰ã€æ ¸å¿ƒè¦ç‚¹æ€»ç»“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    React æµ‹è¯•è¦ç‚¹                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Jest          â†’  æµ‹è¯•è¿è¡Œå™¨ï¼Œé›¶é…ç½®ï¼Œæ”¯æŒå¿«ç…§ã€å¹¶è¡Œã€Mock      â”‚
â”‚  Mock æ•°æ®     â†’  jest.mock() / jest.spyOn()                  â”‚
â”‚  Mock ç»„ä»¶     â†’  jest.mock('path', () => Component)          â”‚
â”‚  Mock è®¡æ—¶å™¨   â†’  useFakeTimers + runAllTimers                â”‚
â”‚  æµ…å±‚æ¸²æŸ“      â†’  Enzyme shallow / react-test-renderer        â”‚
â”‚  å¿«ç…§æµ‹è¯•      â†’  toMatchSnapshot()ï¼Œæ£€æµ‹ UI å˜åŒ–              â”‚
â”‚  DOM ç¯å¢ƒ      â†’  jsdomï¼ˆè½»é‡ï¼‰/ Puppeteerï¼ˆçœŸå®æµè§ˆå™¨ï¼‰       â”‚
â”‚  è¦†ç›–ç‡        â†’  jest --coverage                             â”‚
â”‚  Router æµ‹è¯•   â†’  createMemoryHistory + fireEvent             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æµ‹è¯•åº“æ¨èï¼š@testing-library/reactï¼ˆæ›´æ¥è¿‘ç”¨æˆ·è¡Œä¸ºï¼‰          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**ä¸€å¥è¯æ€»ç»“**ï¼šReact æµ‹è¯•çš„æ ¸å¿ƒæ˜¯é€šè¿‡ Jest æ¨¡æ‹Ÿéš”ç¦»ç¯å¢ƒï¼ˆæ•°æ®ã€ç»„ä»¶ã€è®¡æ—¶å™¨ã€DOMï¼‰ï¼Œè®©æµ‹è¯•å¿«é€Ÿã€ç¨³å®šã€å¯é‡å¤ï¼Œä»è€Œä¿éšœä»£ç è´¨é‡å’Œé‡æ„ä¿¡å¿ƒã€‚