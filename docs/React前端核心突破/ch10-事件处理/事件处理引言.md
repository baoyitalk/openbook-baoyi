# React äº‹ä»¶å¤„ç† - ç¬¬ä¸€æ€§åŸç†æ·±åº¦æ‹†è§£

## ä¸€ã€ç¬¬ä¸€æ€§åŸç†ï¼šä¸ºä»€ä¹ˆ React è¦è‡ªå·±å®ç°äº‹ä»¶ç³»ç»Ÿï¼Ÿ

### æœ¬è´¨æ€è€ƒ

æµè§ˆå™¨åŸç”Ÿäº‹ä»¶å­˜åœ¨ä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š
1. **å…¼å®¹æ€§å·®å¼‚** â€” ä¸åŒæµè§ˆå™¨çš„äº‹ä»¶ API ä¸ä¸€è‡´
2. **æ€§èƒ½é—®é¢˜** â€” å¤§é‡ DOM èŠ‚ç‚¹ç»‘å®šäº‹ä»¶ç›‘å¬å™¨å¼€é”€å¤§

React çš„è§£å†³æ–¹æ¡ˆï¼š**åˆæˆäº‹ä»¶ï¼ˆSyntheticEventï¼‰** â€” åœ¨åŸç”Ÿäº‹ä»¶ä¹‹ä¸Šæ„å»ºä¸€å±‚æŠ½è±¡ï¼Œç»Ÿä¸€æ¥å£ã€ä¼˜åŒ–æ€§èƒ½ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    React äº‹ä»¶ç³»ç»Ÿæ¶æ„                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚    ç”¨æˆ·ä»£ç å±‚     onClick={handleClick}                      â”‚
â”‚         â†“                                                   â”‚
â”‚    åˆæˆäº‹ä»¶å±‚     SyntheticEventï¼ˆè·¨æµè§ˆå™¨åŒ…è£…å™¨ï¼‰             â”‚
â”‚         â†“                                                   â”‚
â”‚    äº‹ä»¶å§”æ‰˜å±‚     rootNode.addEventListener (React 17+)      â”‚
â”‚         â†“                                                   â”‚
â”‚    åŸç”Ÿäº‹ä»¶å±‚     æµè§ˆå™¨ DOM äº‹ä»¶                             â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€React å’Œ DOM äº‹ä»¶å¤„ç†çš„åŒºåˆ«

| å¯¹æ¯”é¡¹ | React | DOM |
|-------|-------|-----|
| **äº‹ä»¶å‘½å** | å°é©¼å³°å¼ `onClick` | çº¯å°å†™ `onclick` |
| **äº‹ä»¶å¤„ç†å‡½æ•°ä¼ å‚** | æ¥å—å‡½æ•° `{handleClick}` | å­—ç¬¦ä¸² `"handleClick()"` |
| **é˜»æ­¢é»˜è®¤è¡Œä¸º** | æ˜¾å¼è°ƒç”¨ `e.preventDefault()` | å¯ç”¨ `return false` |
| **äº‹ä»¶å¯¹è±¡ e** | åˆæˆäº‹ä»¶ï¼ˆW3C è§„èŒƒï¼‰ | `window.event` |
| **æ·»åŠ äº‹ä»¶ç›‘å¬** | JSX åˆå§‹æ¸²æŸ“æ—¶æ·»åŠ  | `addEventListener` |
| **this æŒ‡å‘** | éœ€æ‰‹åŠ¨ç»‘å®š | è‡ªåŠ¨æŒ‡å‘è§¦å‘å…ƒç´  |
| **ä¼ å‚æ–¹å¼** | ç®­å¤´å‡½æ•°æˆ– `bind` | DOM attribute å–å€¼ |
| **äº‹ä»¶å§”æ‰˜** | è‡ªåŠ¨å§”æ‰˜åˆ° rootï¼ˆ17+ï¼‰ | éœ€æ‰‹åŠ¨å®ç° |

### ä»£ç å¯¹æ¯”

```javascript
// âŒ DOM æ–¹å¼
<button onclick="handleClick()">Click</button>

// âœ… React æ–¹å¼
<button onClick={handleClick}>Click</button>
```

---

## ä¸‰ã€ä»€ä¹ˆæ˜¯ React åˆæˆäº‹ä»¶ï¼Ÿ

### å®šä¹‰

**åˆæˆäº‹ä»¶ï¼ˆSyntheticEventï¼‰** æ˜¯æµè§ˆå™¨åŸç”Ÿäº‹ä»¶çš„è·¨æµè§ˆå™¨åŒ…è£…å™¨ï¼š
- å…¼å®¹æ‰€æœ‰æµè§ˆå™¨
- æ¥å£ä¸åŸç”Ÿäº‹ä»¶ç›¸åŒï¼ˆ`stopPropagation()`ã€`preventDefault()`ï¼‰
- åˆæˆäº‹ä»¶å®ä¾‹ä¼šè¢«ä¼ é€’ç»™äº‹ä»¶å¤„ç†å‡½æ•°

### äº‹ä»¶æ‰§è¡Œé¡ºåº

```
åŸç”Ÿäº‹ä»¶å…ˆæ‰§è¡Œ â†’ åˆæˆäº‹ä»¶åæ‰§è¡Œ
     â†“                â†“
  æ•è·é˜¶æ®µ          å†’æ³¡é˜¶æ®µï¼ˆé»˜è®¤ï¼‰
                   onClickCaptureï¼ˆæ•è·ï¼‰
```

### äº‹ä»¶æ± æœºåˆ¶ï¼ˆReact 16 åŠæ›´æ—©ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    äº‹ä»¶æ±  (React 16)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  äº‹ä»¶å¯¹è±¡è¢«é‡ç”¨ â†’ å›è°ƒæ‰§è¡Œåå±æ€§å¤±æ•ˆ â†’ å¼‚æ­¥è®¿é—®éœ€ e.persist() â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    React 17+ æ”¹è¿›                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å»é™¤äº‹ä»¶æ±  â†’ äº‹ä»¶å¯¹è±¡ä¸å†é‡ç”¨ â†’ å¯ç›´æ¥å¼‚æ­¥è®¿é—®å±æ€§           â”‚
â”‚  e.persist() ä¿ç•™ä½†æ— å®é™…ä½œç”¨                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è®¿é—®åŸç”Ÿäº‹ä»¶

```javascript
function handleClick(e) {
  console.log(e);              // åˆæˆäº‹ä»¶
  console.log(e.nativeEvent);  // åŸç”Ÿæµè§ˆå™¨äº‹ä»¶
}
```

---

## å››ã€å¦‚ä½•é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Ÿ

### âŒ é”™è¯¯æ–¹å¼ï¼ˆåœ¨ React ä¸­æ— æ•ˆï¼‰

```javascript
function handleSubmit() {
  return false;  // æ— æ•ˆï¼
}
```

### âœ… æ­£ç¡®æ–¹å¼

```javascript
function handleSubmit(e) {
  e.preventDefault();  // æ˜¾å¼è°ƒç”¨
  // å¤„ç†è¡¨å•æäº¤
}

<form onSubmit={handleSubmit}>
  <button type="submit">Submit</button>
</form>
```

---

## äº”ã€å¦‚ä½•è§£å†³ Class ç»„ä»¶ä¸­ this ä¸º undefinedï¼Ÿ

### é—®é¢˜æ ¹æº

```javascript
class Button extends React.Component {
  handleClick() {
    console.log(this);  // undefined âŒ
  }
  render() {
    return <button onClick={this.handleClick}>Click</button>;
  }
}
```

äº‹ä»¶å¤„ç†å‡½æ•°ä½œä¸ºå›è°ƒä¼ é€’æ—¶ï¼Œä¸¢å¤±äº† `this` ä¸Šä¸‹æ–‡ã€‚

### ä¸‰ç§è§£å†³æ–¹æ¡ˆ

| æ–¹æ¡ˆ | ä»£ç  | æ¨èåº¦ |
|-----|------|-------|
| **constructor ä¸­ bind** | `this.handleClick = this.handleClick.bind(this)` | â­â­â­ |
| **class fields è¯­æ³•** | `handleClick = () => { }` | â­â­â­â­â­ |
| **JSX ä¸­åŒ¿åç®­å¤´å‡½æ•°** | `onClick={() => this.handleClick()}` | â­ï¼ˆä¸æ¨èï¼‰ |

### å®Œæ•´ä»£ç ç¤ºä¾‹

```javascript
// âœ… æ–¹æ¡ˆ1ï¼šconstructor ä¸­ bind
class Button extends React.Component {
  constructor(props) {
    super(props);
    this.handleClick = this.handleClick.bind(this);
  }
  handleClick() {
    console.log(this);  // âœ… ç»„ä»¶å®ä¾‹
  }
  render() {
    return <button onClick={this.handleClick}>Click</button>;
  }
}

// âœ… æ–¹æ¡ˆ2ï¼šclass fields è¯­æ³•ï¼ˆæ¨èï¼‰
class Button extends React.Component {
  handleClick = () => {
    console.log(this);  // âœ… ç»„ä»¶å®ä¾‹
  }
  render() {
    return <button onClick={this.handleClick}>Click</button>;
  }
}

// âš ï¸ æ–¹æ¡ˆ3ï¼šåŒ¿åç®­å¤´å‡½æ•°ï¼ˆä¸æ¨èï¼‰
// æ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°å‡½æ•°ï¼Œå¯èƒ½å¯¼è‡´å­ç»„ä»¶é¢å¤–é‡æ¸²æŸ“
<button onClick={() => this.handleClick()}>Click</button>
```

---

## å…­ã€å¦‚ä½•ä¼ å‚ç»™äº‹ä»¶å¤„ç†å‡½æ•°ï¼Ÿ

### ä¸¤ç§æ–¹å¼

```javascript
// æ–¹å¼1ï¼šç®­å¤´å‡½æ•°ï¼ˆä¸æ¨èç”¨äºæ€§èƒ½æ•æ„Ÿåœºæ™¯ï¼‰
<button onClick={() => handleDelete(id)}>Delete</button>

// æ–¹å¼2ï¼šbind ä¼ å‚
<button onClick={handleDelete.bind(this, id)}>Delete</button>
```

### bind çš„å·¥ä½œåŸç†

```javascript
// bind è¿”å›æ–°å‡½æ•°ï¼Œæ–°å‡½æ•°çš„ this æ˜¯ bind çš„ç¬¬ä¸€ä¸ªå‚æ•°
// å…¶ä½™å‚æ•°ä½œä¸ºå‡½æ•°çš„é¢„ç½®å‚æ•°
const boundFn = fn.bind(thisArg, arg1, arg2);
boundFn(arg3);  // ç›¸å½“äº fn.call(thisArg, arg1, arg2, arg3)
```

### å®Œæ•´ç¤ºä¾‹

```javascript
function TodoList({ todos, onDelete }) {
  return (
    <ul>
      {todos.map(todo => (
        <li key={todo.id}>
          {todo.text}
          {/* ä¼ é€’ id å‚æ•° */}
          <button onClick={() => onDelete(todo.id)}>åˆ é™¤</button>
        </li>
      ))}
    </ul>
  );
}
```

---

## ä¸ƒã€å¦‚ä½•é˜»æ­¢äº‹ä»¶å¤„ç†å‡½æ•°è¢«é¢‘ç¹è°ƒç”¨ï¼Ÿ

### èŠ‚æµ vs é˜²æŠ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      èŠ‚æµ (Throttle)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä¸€å®šæ—¶é—´å†…åªæ‰§è¡Œä¸€æ¬¡                                         â”‚
â”‚  æ ¸å¿ƒï¼šå®šæ—¶å™¨ä¸é‡ç½®                                           â”‚
â”‚  è¿ç»­è§¦å‘ â†’ åªæœ‰ç¬¬ä¸€æ¬¡ç”Ÿæ•ˆï¼Œå¿½ç•¥åé¢è°ƒç”¨                        â”‚
â”‚  åœºæ™¯ï¼šæ»šåŠ¨äº‹ä»¶ã€resizeã€æ‹–æ‹½                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      é˜²æŠ– (Debounce)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä¸€å®šæ—¶é—´å†…æœ€å¤šè°ƒç”¨ä¸€æ¬¡                                       â”‚
â”‚  æ ¸å¿ƒï¼šå®šæ—¶å™¨é‡ç½®                                             â”‚
â”‚  è¿ç»­è§¦å‘ â†’ åªæœ‰æœ€åä¸€æ¬¡ç”Ÿæ•ˆï¼Œå¿½ç•¥å‰é¢è°ƒç”¨                      â”‚
â”‚  åœºæ™¯ï¼šæœç´¢è¾“å…¥ã€è¡¨å•éªŒè¯ã€çª—å£ resize ç»“æŸ                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ‰‹å†™èŠ‚æµ

```javascript
// åŸç”Ÿå®ç°
const throttle = (fn, delay) => {
  let timer = null;
  return function (...args) {
    if (timer) return;  // å®šæ—¶å™¨å­˜åœ¨åˆ™å¿½ç•¥
    timer = setTimeout(() => {
      timer = null;
      fn.apply(this, args);
    }, delay || 1000 / 60);
  };
};

// React Hook å®ç°
const useThrottle = (fn, delay) => {
  const ref = useRef(fn);
  useEffect(() => {
    ref.current = fn;
  });
  return useCallback(
    throttle((...args) => ref.current(...args), delay),
    [delay]
  );
};
```

### æ‰‹å†™é˜²æŠ–

```javascript
// åŸç”Ÿå®ç°
const debounce = (fn, delay) => {
  let timer = null;
  return function (...args) {
    if (timer) clearTimeout(timer);  // é‡ç½®å®šæ—¶å™¨
    timer = setTimeout(() => {
      timer = null;
      fn.apply(this, args);
    }, delay || 1000 / 60);
  };
};

// React Hook å®ç°
const useDebounce = (fn, delay) => {
  const ref = useRef(fn);
  useEffect(() => {
    ref.current = fn;
  });
  return useCallback(
    debounce((...args) => ref.current(...args), delay),
    [delay]
  );
};
```

### ä½¿ç”¨ç¤ºä¾‹

```javascript
function SearchInput() {
  const [value, setValue] = useState('');
  
  // é˜²æŠ–æœç´¢ï¼šè¾“å…¥åœæ­¢ 300ms åæ‰è§¦å‘
  const debouncedSearch = useDebounce((query) => {
    fetchSearchResults(query);
  }, 300);

  const handleChange = (e) => {
    setValue(e.target.value);
    debouncedSearch(e.target.value);
  };

  return <input value={value} onChange={handleChange} />;
}
```

---

## å…«ã€React 17 å¯¹äº‹ä»¶å¤„ç†çš„æ”¹è¿›

### 1. äº‹ä»¶å§”æ‰˜ä½ç½®å˜æ›´

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    React 16 åŠä¹‹å‰                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  document.addEventListener()                                â”‚
â”‚  æ‰€æœ‰äº‹ä»¶å§”æ‰˜åˆ° document ä¸Š                                   â”‚
â”‚  é—®é¢˜ï¼šå¤š React ç‰ˆæœ¬å…±å­˜æ—¶ï¼ŒstopPropagation æ— æ³•é˜»æ­¢å¤–éƒ¨æ ‘     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    React 17+                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  rootNode.addEventListener()                                â”‚
â”‚  äº‹ä»¶å§”æ‰˜åˆ° React æ ‘çš„æ ¹ DOM å®¹å™¨                             â”‚
â”‚  ä¼˜åŠ¿ï¼šå¤šç‰ˆæœ¬ React å¯å®‰å…¨å…±å­˜ï¼ŒstopPropagation è¡Œä¸ºç¬¦åˆé¢„æœŸ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. äº‹ä»¶è¡Œä¸ºå¯¹é½æµè§ˆå™¨

| äº‹ä»¶ | React 16 | React 17 |
|-----|----------|----------|
| `onScroll` | å†’æ³¡ | **ä¸å†å†’æ³¡** |
| `onFocus/onBlur` | React è‡ªå®ç° | åº•å±‚ä½¿ç”¨åŸç”Ÿ `focusin/focusout` |
| `onClickCapture` | React å®ç° | **ä½¿ç”¨æµè§ˆå™¨åŸç”Ÿæ•è·ç›‘å¬å™¨** |

### 3. å»é™¤äº‹ä»¶æ± 

```javascript
// React 16ï¼šå¼‚æ­¥è®¿é—®äº‹ä»¶å±æ€§éœ€è¦ persist
function handleClick(e) {
  e.persist();  // å¿…é¡»è°ƒç”¨
  setTimeout(() => {
    console.log(e.target);  // æ‰èƒ½æ­£å¸¸è®¿é—®
  }, 100);
}

// React 17+ï¼šç›´æ¥è®¿é—®
function handleClick(e) {
  setTimeout(() => {
    console.log(e.target);  // âœ… ç›´æ¥å¯ç”¨
  }, 100);
}
// e.persist() ä¿ç•™ä½†æ— å®é™…ä½œç”¨ï¼Œä¸ºäº†å…¼å®¹
```

---

## ä¹ã€é¢è¯•é—®ç­”é€ŸæŸ¥

| é—®é¢˜ | ç­”æ¡ˆ |
|-----|------|
| React äº‹ä»¶å’ŒåŸç”Ÿäº‹ä»¶å“ªä¸ªå…ˆæ‰§è¡Œï¼Ÿ | åŸç”Ÿäº‹ä»¶å…ˆæ‰§è¡Œï¼Œåˆæˆäº‹ä»¶åæ‰§è¡Œ |
| ä¸ºä»€ä¹ˆ React è‡ªå·±å®ç°äº‹ä»¶ç³»ç»Ÿï¼Ÿ | è·¨æµè§ˆå™¨å…¼å®¹ + äº‹ä»¶å§”æ‰˜ä¼˜åŒ–æ€§èƒ½ |
| å¦‚ä½•åœ¨ React ä¸­è·å–åŸç”Ÿäº‹ä»¶ï¼Ÿ | `e.nativeEvent` |
| React 17 ä¸ºä»€ä¹ˆæ”¹å˜äº‹ä»¶å§”æ‰˜ä½ç½®ï¼Ÿ | æ”¯æŒå¤š React ç‰ˆæœ¬å…±å­˜ï¼Œæ¸è¿›å¼å‡çº§ |
| èŠ‚æµå’Œé˜²æŠ–çš„æ ¸å¿ƒåŒºåˆ«ï¼Ÿ | èŠ‚æµï¼šå®šæ—¶å™¨ä¸é‡ç½®ï¼Œç¬¬ä¸€æ¬¡ç”Ÿæ•ˆï¼›é˜²æŠ–ï¼šå®šæ—¶å™¨é‡ç½®ï¼Œæœ€åä¸€æ¬¡ç”Ÿæ•ˆ |
| ä¸ºä»€ä¹ˆä¸æ¨è JSX ä¸­å†™åŒ¿åç®­å¤´å‡½æ•°ï¼Ÿ | æ¯æ¬¡æ¸²æŸ“åˆ›å»ºæ–°å‡½æ•°å¼•ç”¨ï¼Œå¯èƒ½å¯¼è‡´å­ç»„ä»¶ä¸å¿…è¦çš„é‡æ¸²æŸ“ |

---

## åã€ç»å…¸é¢è¯•ä»£ç 

### é¢è¯•é¢˜ 1ï¼šåˆæˆäº‹ä»¶ä¸åŸç”Ÿäº‹ä»¶æ‰§è¡Œé¡ºåº ğŸ”¥

```javascript
class App extends React.Component {
  componentDidMount() {
    document.getElementById('btn').addEventListener('click', () => {
      console.log('åŸç”Ÿäº‹ä»¶');
    });
    document.addEventListener('click', () => {
      console.log('document åŸç”Ÿäº‹ä»¶');
    });
  }

  handleClick = () => {
    console.log('React åˆæˆäº‹ä»¶');
  };

  render() {
    return <button id="btn" onClick={this.handleClick}>Click</button>;
  }
}

// ç‚¹å‡»æŒ‰é’®è¾“å‡ºé¡ºåºï¼š
// 1. "åŸç”Ÿäº‹ä»¶"          (å…ƒç´ åŸç”Ÿï¼Œæ•è·/å†’æ³¡åˆ°å…ƒç´ )
// 2. "React åˆæˆäº‹ä»¶"    (React 17: root ä¸Šè§¦å‘)
// 3. "document åŸç”Ÿäº‹ä»¶" (å†’æ³¡åˆ° document)
```

### é¢è¯•é¢˜ 2ï¼šé˜»æ­¢äº‹ä»¶å†’æ³¡çš„å‘ ğŸ”¥

```javascript
function App() {
  useEffect(() => {
    document.addEventListener('click', () => {
      console.log('document clicked');
    });
  }, []);

  const handleClick = (e) => {
    e.stopPropagation();  // åªèƒ½é˜»æ­¢ React åˆæˆäº‹ä»¶å†’æ³¡
    console.log('button clicked');
  };

  return <button onClick={handleClick}>Click</button>;
}

// React 16: stopPropagation æ— æ³•é˜»æ­¢ document ä¸Šçš„åŸç”Ÿäº‹ä»¶
// React 17: stopPropagation å¯ä»¥é˜»æ­¢ï¼ˆå› ä¸ºå§”æ‰˜åœ¨ root ä¸Šï¼‰
```

### é¢è¯•é¢˜ 3ï¼šå®Œæ•´çš„é˜²æŠ– Hook ğŸ”¥

```javascript
function useDebounce(value, delay) {
  const [debouncedValue, setDebouncedValue] = useState(value);

  useEffect(() => {
    const timer = setTimeout(() => {
      setDebouncedValue(value);
    }, delay);

    return () => clearTimeout(timer);  // æ¸…ç†
  }, [value, delay]);

  return debouncedValue;
}

// ä½¿ç”¨
function SearchComponent() {
  const [input, setInput] = useState('');
  const debouncedInput = useDebounce(input, 500);

  useEffect(() => {
    if (debouncedInput) {
      // å‘èµ·æœç´¢è¯·æ±‚
      searchAPI(debouncedInput);
    }
  }, [debouncedInput]);

  return <input value={input} onChange={e => setInput(e.target.value)} />;
}
```

### é¢è¯•é¢˜ 4ï¼šäº‹ä»¶å¤„ç†çš„ this ç»‘å®šå¯¹æ¯” â­

```javascript
class Counter extends React.Component {
  state = { count: 0 };

  // âŒ æ™®é€šæ–¹æ³•ï¼šthis ä¸¢å¤±
  handleClick1() {
    this.setState({ count: this.state.count + 1 });
  }

  // âœ… class fieldsï¼šè‡ªåŠ¨ç»‘å®š
  handleClick2 = () => {
    this.setState({ count: this.state.count + 1 });
  };

  render() {
    return (
      <>
        {/* âŒ this ä¸º undefined */}
        <button onClick={this.handleClick1}>+1</button>
        
        {/* âœ… æ­£å¸¸å·¥ä½œ */}
        <button onClick={this.handleClick2}>+1</button>
        
        {/* âœ… bind ç»‘å®š */}
        <button onClick={this.handleClick1.bind(this)}>+1</button>
        
        {/* âš ï¸ ç®­å¤´å‡½æ•°åŒ…è£¹ï¼ˆæ€§èƒ½å·®ï¼‰ */}
        <button onClick={() => this.handleClick1()}>+1</button>
      </>
    );
  }
}
```

---

## åä¸€ã€æ ¸å¿ƒè¦ç‚¹æ€»ç»“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    React äº‹ä»¶ç³»ç»Ÿè¦ç‚¹                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åˆæˆäº‹ä»¶ = è·¨æµè§ˆå™¨åŒ…è£…å™¨ï¼Œç»Ÿä¸€ API                             â”‚
â”‚  äº‹ä»¶å§”æ‰˜ = React 16 åœ¨ documentï¼ŒReact 17+ åœ¨ rootNode         â”‚
â”‚  æ‰§è¡Œé¡ºåº = åŸç”Ÿå…ˆ â†’ åˆæˆå                                     â”‚
â”‚  é˜»æ­¢é»˜è®¤ = å¿…é¡» e.preventDefault()ï¼Œreturn false æ— æ•ˆ          â”‚
â”‚  this ç»‘å®š = æ¨è class fields ç®­å¤´å‡½æ•°                         â”‚
â”‚  æ€§èƒ½ä¼˜åŒ– = èŠ‚æµï¼ˆç¬¬ä¸€æ¬¡ç”Ÿæ•ˆï¼‰ã€é˜²æŠ–ï¼ˆæœ€åä¸€æ¬¡ç”Ÿæ•ˆï¼‰               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**ä¸€å¥è¯æ€»ç»“**ï¼šReact åˆæˆäº‹ä»¶æ˜¯å¯¹åŸç”Ÿäº‹ä»¶çš„è·¨æµè§ˆå™¨å°è£…ä¸æ€§èƒ½ä¼˜åŒ–ï¼Œé€šè¿‡äº‹ä»¶å§”æ‰˜ç»Ÿä¸€ç®¡ç†ï¼Œå¼€å‘è€…åªéœ€å…³æ³¨ä¸šåŠ¡é€»è¾‘è€Œéæµè§ˆå™¨å…¼å®¹æ€§ã€‚