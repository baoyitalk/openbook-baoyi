# 浅拷贝 vs 深拷贝 - 第一性原理拆解

---

## 第一步：理解内存的本质

### 变量存储的真相

```
┌─────────────────────────────────────────────────────────┐
│                        内存                              │
├─────────────────────────────────────────────────────────┤
│                                                         │
│   变量名        内存地址         实际数据                 │
│   ──────       ────────        ────────                 │
│                                                         │
│    a    ───→   [0x001]   ───→    1                      │
│                                 (直接存值)               │
│                                                         │
│    obj  ───→   [0x002]   ───→   指针 ───→ { x: 1 }      │
│                                 (存的是地址)             │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 核心概念：值类型 vs 引用类型

```
┌──────────────────────┐      ┌──────────────────────────┐
│      值类型           │      │        引用类型           │
│  (数字、字符串、布尔)   │      │   (对象、数组、函数)       │
├──────────────────────┤      ├──────────────────────────┤
│                      │      │                          │
│   变量直接存储值       │      │   变量存储的是"地址"       │
│                      │      │   地址指向真实数据         │
│   a = 5              │      │   obj = { x: 1 }         │
│   ┌───┐              │      │   ┌───┐    ┌───────┐     │
│   │ 5 │              │      │   │ → │───→│ x: 1  │     │
│   └───┘              │      │   └───┘    └───────┘     │
│                      │      │                          │
└──────────────────────┘      └──────────────────────────┘
```

---

## 第二步：理解"拷贝"到底在拷贝什么

### 简单赋值（不是拷贝！）

```javascript
let obj1 = { name: "张三" };
let obj2 = obj1;  // 这不是拷贝！
```

```
        obj1                    obj2
         │                       │
         │                       │
         ▼                       ▼
      ┌─────┐                 ┌─────┐
      │0x100│                 │0x100│   ← 存的是同一个地址！
      └──┬──┘                 └──┬──┘
         │                       │
         └───────────┬───────────┘
                     │
                     ▼
              ┌─────────────┐
              │ name: "张三" │   ← 只有一份数据
              └─────────────┘

修改 obj2.name = "李四"
obj1.name 也变成 "李四"  ← 因为是同一个对象！
```

---

## 第三步：浅拷贝的工作原理

### 浅拷贝做了什么？

> **只复制第一层**：创建新对象，把第一层属性值"原样复制"过去

```javascript
let original = {
    a: 1,           // 值类型
    b: { c: 2 }     // 引用类型（嵌套对象）
};

let shallow = { ...original };  // 浅拷贝
```

### 图解浅拷贝过程

```
                    浅拷贝过程
                    ═════════

  original                              shallow (新建的对象)
  ────────                              ──────────────────
      │                                       │
      ▼                                       ▼
  ┌────────────┐                         ┌────────────┐
  │ a: 1       │  ── 复制值 1 ──────────→ │ a: 1       │  ✅ 独立
  │            │                         │            │
  │ b: 0x200   │  ── 复制地址 0x200 ────→ │ b: 0x200   │  ❌ 共享
  └────────────┘                         └────────────┘
                     │                         │
                     │                         │
                     └──────────┬──────────────┘
                                │
                                ▼
                         ┌──────────┐
                         │  c: 2    │  ← 只有一份！两边共享
                         └──────────┘
```

### 浅拷贝的问题演示

```
修改前:
═══════
original.a = 1        shallow.a = 1
original.b.c = 2      shallow.b.c = 2


修改 shallow.a = 100 (值类型):
════════════════════════════════
original.a = 1   ✅ 不受影响（各自独立）
shallow.a = 100


修改 shallow.b.c = 999 (嵌套对象):
════════════════════════════════════
original.b.c = 999  ❌ 被影响了！
shallow.b.c = 999      （因为共享同一个对象）
```

---

## 第四步：深拷贝的工作原理

### 深拷贝做了什么？

> **递归复制所有层级**：遇到嵌套对象，继续往下拷贝，直到全是值类型

```javascript
let original = {
    a: 1,
    b: { c: 2 }
};

let deep = JSON.parse(JSON.stringify(original));  // 深拷贝
```

### 图解深拷贝过程

```
                    深拷贝过程
                    ═════════

  original                              deep (完全独立的新对象)
  ────────                              ────────────────────
      │                                       │
      ▼                                       ▼
  ┌────────────┐                         ┌────────────┐
  │ a: 1       │  ── 复制值 1 ──────────→ │ a: 1       │
  │            │                         │            │
  │ b: 0x200   │                         │ b: 0x300   │  ← 新地址！
  └────────────┘                         └────────────┘
        │                                       │
        ▼                                       ▼
  ┌──────────┐                           ┌──────────┐
  │  c: 2    │   ── 递归复制 ──────────→  │  c: 2    │
  └──────────┘                           └──────────┘
  (地址 0x200)                           (地址 0x300)

  两份完全独立的数据！
```

### 深拷贝的效果

```
修改 deep.b.c = 999:
════════════════════

original.b.c = 2    ✅ 完全不受影响
deep.b.c = 999      ✅ 只改了自己的副本
```

---

## 第五步：完整对比图

```
┌─────────────────────────────────────────────────────────────────┐
│                         原始对象                                 │
│                                                                 │
│                    { a: 1, b: { c: 2 } }                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
                    │                       │
          ┌────────┴────────┐     ┌────────┴────────┐
          │    浅拷贝        │     │    深拷贝        │
          │  (只复制一层)    │     │  (递归全复制)    │
          └────────┬────────┘     └────────┬────────┘
                   │                       │
                   ▼                       ▼
┌─────────────────────────────┐ ┌─────────────────────────────┐
│                             │ │                             │
│  original      shallow      │ │  original      deep         │
│     │             │         │ │     │           │           │
│     ▼             ▼         │ │     ▼           ▼           │
│  ┌─────┐      ┌─────┐       │ │  ┌─────┐     ┌─────┐        │
│  │ a:1 │      │ a:1 │ 独立  │ │  │ a:1 │     │ a:1 │  独立  │
│  │ b:→ │      │ b:→ │       │ │  │ b:→ │     │ b:→ │        │
│  └──┬──┘      └──┬──┘       │ │  └──┬──┘     └──┬──┘        │
│     │            │          │ │     │           │           │
│     └─────┬──────┘          │ │     ▼           ▼           │
│           ▼                 │ │  ┌─────┐     ┌─────┐        │
│       ┌───────┐             │ │  │ c:2 │     │ c:2 │  独立  │
│       │ c: 2  │  共享！     │ │  └─────┘     └─────┘        │
│       └───────┘             │ │                             │
│                             │ │                             │
│  ❌ 改b.c会互相影响         │ │  ✅ 完全独立                 │
│                             │ │                             │
└─────────────────────────────┘ └─────────────────────────────┘
```

---

## 一句话总结

| | 浅拷贝 | 深拷贝 |
|---|--------|--------|
| **做法** | 复制第一层，嵌套对象只复制地址 | 递归复制所有层级 |
| **结果** | 嵌套对象共享，会互相影响 | 完全独立，互不影响 |
| **比喻** | 复印房产证（房子还是同一套）| 真的再建一套一模一样的房子 |

还有疑问可以继续问！